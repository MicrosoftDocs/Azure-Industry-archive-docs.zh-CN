---
title: 预测性维护解决方案
author: ercenk
ms.author: ercenk
ms.date: 05/03/2018
ms.topic: article
ms.service: industry
description: 有关如何为 Azure 上的制造客户开发预测性维护的解决方案说明。
ms.openlocfilehash: 1c7b95e2da21df46465ccaf21827ae97597206a2
ms.sourcegitcommit: 76f2862adbec59311b5888e043a120f89dc862af
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/03/2018
ms.locfileid: "51654314"
---
# <a name="predictive-maintenance-in-manufacturing-solution-guide"></a><span data-ttu-id="46ac6-103">制造解决方案指南中的预测性维护</span><span class="sxs-lookup"><span data-stu-id="46ac6-103">Predictive Maintenance in Manufacturing Solution Guide</span></span>


## <a name="introduction"></a><span data-ttu-id="46ac6-104">介绍</span><span class="sxs-lookup"><span data-stu-id="46ac6-104">Introduction</span></span>

<span data-ttu-id="46ac6-105">预测性维护综合使用传感器、人工智能和数据科学来优化设备维护。</span><span class="sxs-lookup"><span data-stu-id="46ac6-105">Predictive maintenance uses a combination of sensors, artificial intelligence, and data science to optimize equipment maintenance.</span></span> <span data-ttu-id="46ac6-106">预期的设备维护需要最大程度地降低维护成本并最大程度地提高正常运行时间，从而为制造商提供巨大价值。</span><span class="sxs-lookup"><span data-stu-id="46ac6-106">Anticipating equipment maintenance needs to minimize maintenance costs and maximize uptime provides significant value to manufacturers.</span></span>

<span data-ttu-id="46ac6-107">数据是解决方案的核心。</span><span class="sxs-lookup"><span data-stu-id="46ac6-107">Data lies at the heart of the solution.</span></span> <span data-ttu-id="46ac6-108">数据需要有足够的故障指示器，以及描述上下文的其他方面。</span><span class="sxs-lookup"><span data-stu-id="46ac6-108">The data needs to have adequate failure indicators, as well as other aspects that describe the context.</span></span> <span data-ttu-id="46ac6-109">它可以来自多个来源，例如传感器、机器日志和制造应用程序日志。</span><span class="sxs-lookup"><span data-stu-id="46ac6-109">It can come from multiple sources, such as sensors, machine logs, and manufacturing application logs.</span></span>

<span data-ttu-id="46ac6-110">本文介绍了生成预测性维护解决方案的选项。</span><span class="sxs-lookup"><span data-stu-id="46ac6-110">This article presents options for building a predictive maintenance solution.</span></span> <span data-ttu-id="46ac6-111">它提供了不同的视角并引用现有材料，以帮助你入门。</span><span class="sxs-lookup"><span data-stu-id="46ac6-111">It presents different perspectives and reference existing materials to get you started.</span></span> <span data-ttu-id="46ac6-112">预测性维护解决方案的要求因设备、环境、流程和组织而异；我们正在尝试提供替代方法和技术，以指导你提出你所需的解决方案。</span><span class="sxs-lookup"><span data-stu-id="46ac6-112">The requirements for a predictive maintenance solution vary by equipment, environment, process, and organization; we are attempting to give alternative approaches and technologies for guiding you in the journey of coming up with a solution for your needs.</span></span>

<span data-ttu-id="46ac6-113">让我们从预测性维护解决方案的高级别组件开始。</span><span class="sxs-lookup"><span data-stu-id="46ac6-113">Let’s start with the high-level components of a predictive maintenance solution.</span></span>


![高级别的解决方案](./assets/pdm-assets/highlevelsolution.png)

<span data-ttu-id="46ac6-115">在此明细中，发生以下高级别活动：</span><span class="sxs-lookup"><span data-stu-id="46ac6-115">In this breakdown, the following high-level activities occur:</span></span>

1. <span data-ttu-id="46ac6-116">收集定型数据，包括失败数据</span><span class="sxs-lookup"><span data-stu-id="46ac6-116">Collect training data, including failure data</span></span>

2. <span data-ttu-id="46ac6-117">利用此定型数据，训练机器学习 (ML) 模型，以在给定一组条件的情况下预测未来资产故障</span><span class="sxs-lookup"><span data-stu-id="46ac6-117">With this training data, train a Machine Learning (ML) model to predict  future asset failures given a set of conditions</span></span>

3. <span data-ttu-id="46ac6-118">继续不断收集数据</span><span class="sxs-lookup"><span data-stu-id="46ac6-118">Continue collecting data on an ongoing basis</span></span>

4. <span data-ttu-id="46ac6-119">将收集的数据输入 ML 模型，该操作可预测故障，通常具有一定的可信度（例如：“机器在未来 24 小时内出现故障的可能性为 85%”）</span><span class="sxs-lookup"><span data-stu-id="46ac6-119">Input the collected data to the ML model, which will predict failure,  normally with some level of confidence (for example: “there is an 85%  probability that the machine will fail in the next 24 hours”)</span></span>

5. <span data-ttu-id="46ac6-120">显示预测的故障情况</span><span class="sxs-lookup"><span data-stu-id="46ac6-120">Surface the predicted failure cases</span></span>

6. <span data-ttu-id="46ac6-121">根据数据中的见解进行规划并采取操作</span><span class="sxs-lookup"><span data-stu-id="46ac6-121">Plan and act on the insights seen in the data</span></span>

## <a name="training-the-ml-model"></a><span data-ttu-id="46ac6-122">定型 ML 模型</span><span class="sxs-lookup"><span data-stu-id="46ac6-122">Training the ML Model</span></span>

<span data-ttu-id="46ac6-123">生成 ML 模型需要足够、正确且完整的数据。</span><span class="sxs-lookup"><span data-stu-id="46ac6-123">Building an ML model requires sufficient, correct and complete data.</span></span> <span data-ttu-id="46ac6-124">此外，预测性维护带来了独特的挑战，其中一个主要问题是故障数据的可用性。</span><span class="sxs-lookup"><span data-stu-id="46ac6-124">In addition, predictive maintenance poses unique challenges, a major one being the availability of failure data.</span></span> <span data-ttu-id="46ac6-125">故障是相对罕见的事件 - 特别是在投资较大的设备中（例如 CNC 机器或炼油厂的组件），因此，即使我们长时间收集传感器数据，也可能不具有足够的故障数据。</span><span class="sxs-lookup"><span data-stu-id="46ac6-125">Failures are relatively rare events – particularly in high-capital equipment, such as CNC machines, or components of oil refineries; so even if we have collected sensor data over a long period of time, we may not have sufficient failure data.</span></span> <span data-ttu-id="46ac6-126">考虑如何定义“故障”，故障究竟由什么构成？</span><span class="sxs-lookup"><span data-stu-id="46ac6-126">Consider how “failure” is defined; what exactly constitutes a failure?</span></span> <span data-ttu-id="46ac6-127">设备意外停止工作时是否可称为故障？</span><span class="sxs-lookup"><span data-stu-id="46ac6-127">Is it when the device stops working unexpectedly?</span></span>
<span data-ttu-id="46ac6-128">设备降级到它无法继续在所需级别运行的级别时是否可称为故障？</span><span class="sxs-lookup"><span data-stu-id="46ac6-128">Is it when the device degrades to a level where it is not performing at a desired level anymore?</span></span> <span data-ttu-id="46ac6-129">在灾难发生之前，由于金属疲劳引起的组件故障或其他指示故障的指标导致切割机损坏是否可称为故障情况？</span><span class="sxs-lookup"><span data-stu-id="46ac6-129">Is the failure case a cutting machine being destroyed, because of a component failure caused by metal fatigue, or other indicators that point a failure, before a catastrophe happens?</span></span>

## <a name="considering-the-data-needed-for-ml"></a><span data-ttu-id="46ac6-130">考虑 ML 所需的数据</span><span class="sxs-lookup"><span data-stu-id="46ac6-130">Considering the Data Needed for ML</span></span>

<span data-ttu-id="46ac6-131">还要考虑我们是否正在捕获足够的数据来正确记录这些故障？</span><span class="sxs-lookup"><span data-stu-id="46ac6-131">Consider, too, are we capturing enough data to record it these failures properly?</span></span> <span data-ttu-id="46ac6-132">在许多情况下，单独的传感器数据可能不足以识别故障。</span><span class="sxs-lookup"><span data-stu-id="46ac6-132">In many cases, sensor data alone may not be enough to identify a failure.</span></span> <span data-ttu-id="46ac6-133">有时我们可能需要外部数据来将机器的状态“标记”为故障状态或辅助信息源，例如运算符通过不同的系统捕获故障情况。</span><span class="sxs-lookup"><span data-stu-id="46ac6-133">Sometimes we may need external data to “flag” a machine’s state as a failure state, or a secondary source of information, such as an operator capturing the failure case through a different system.</span></span> <span data-ttu-id="46ac6-134">该数据可能存在于 ERP、制造执行系统 (MES)、历史库等外部系统中，并且跨越了制造企业中普遍存在的著名 IT/OT 鸿沟，使得保护必要数据的安全更加具有挑战性。</span><span class="sxs-lookup"><span data-stu-id="46ac6-134">This data may be residing in external systems such as ERP, manufacturing execution systems (MES), historians, etc., and cross the infamous IT/OT divide so prevalent in manufacturing firms, making securing the necessary data extra challenging.</span></span>

<span data-ttu-id="46ac6-135">从本质上讲，预测性维护是一个动态问题，因此，相关机器学习模型需要不断刷新（或重新定型）。</span><span class="sxs-lookup"><span data-stu-id="46ac6-135">By nature, predictive maintenance is a dynamic problem and, as such, associated machine learning models need to be continuously refreshed (or re-trained).</span></span> <span data-ttu-id="46ac6-136">如果做得好，预测性维护应可减少故障实例，这是一件好事，但会导致故障数据变得更少。</span><span class="sxs-lookup"><span data-stu-id="46ac6-136">If done well, predictive maintenance should reduce the instances of failures - which is a good thing, but results in less failure data.</span></span> <span data-ttu-id="46ac6-137">此外，影响故障的功能可能会改变，致使先前机器学习模型无效。</span><span class="sxs-lookup"><span data-stu-id="46ac6-137">Also, the features that affect failure may change invalidating prior machine learning models.</span></span> <span data-ttu-id="46ac6-138">我们建议定期定型模型，以应对故障状况的任何变化。</span><span class="sxs-lookup"><span data-stu-id="46ac6-138">We recommend training models periodically with any changes in failure conditions.</span></span>

<span data-ttu-id="46ac6-139">“新鲜”数据也意味着将新条件引入模型，而不是先前用于定型模型的条件。</span><span class="sxs-lookup"><span data-stu-id="46ac6-139">“Fresh” data also mean new conditions brought into the model, other than the one previously used for training the model.</span></span> <span data-ttu-id="46ac6-140">换句话说，我们可以将故障模型化为变量 _x<sub>1</sub>,x<sub>2</sub>,⋯,x<sub>n</sub>，f(x<sub>1</sub>,x<sub>2</sub>,⋯,x<sub>n</sub>)_ 的函数，但最终我们可能会发现变量 _x<sub>(n+1)</sub>,⋯,x<sub>(m+n)</sub>_ 也会影响故障，因此我们可能需要修改 _f(x<sub>1</sub>,x<sub>2</sub>,⋯,x<sub>(m+n)</sub>)_ 的模型定型。</span><span class="sxs-lookup"><span data-stu-id="46ac6-140">In other words, we may model the failure as the function of variables _x<sub>1</sub>,x<sub>2</sub>,⋯,x<sub>n</sub>, f(x<sub>1</sub>,x<sub>2</sub>,⋯,x<sub>n</sub>)_, but eventually we may discover variables _x<sub>(n+1)</sub>,⋯,x<sub>(m+n)</sub>_ are also influencing the failure, thus we may need to modify our model training for _f(x<sub>1</sub>,x<sub>2</sub>,⋯,x<sub>(m+n)</sub>)_.</span></span> <span data-ttu-id="46ac6-141">该模型可能无法很好地检测故障，并且可以生成新模型，包括来自计算机的 MES 日志的数据点以及下一次迭代。</span><span class="sxs-lookup"><span data-stu-id="46ac6-141">The model may not be performing well for detecting the failures, and a new model may be built including data points from the machine’s MES logs as well for the next iteration.</span></span>

<span data-ttu-id="46ac6-142">即使没有现代 IoT 环境将数据流式传输到云，定型机器学习模型所需的数据可能也已经存在于 MES、历史库或其他生产系统中。</span><span class="sxs-lookup"><span data-stu-id="46ac6-142">Even without a modern IoT environment streaming data to the cloud, the data needed to train the machine learning models may be already in your MES, historians, or other production systems.</span></span> <span data-ttu-id="46ac6-143">这只是准备数据的问题，因此可用于定型机器学习模型。</span><span class="sxs-lookup"><span data-stu-id="46ac6-143">It’s just a matter of preparing the data so it can be used to train the machine learning models.</span></span>

<span data-ttu-id="46ac6-144">下图说明了定型 ML 模型的典型工作流。</span><span class="sxs-lookup"><span data-stu-id="46ac6-144">The following figure illustrates the typical workflow for training a ML model.</span></span> <span data-ttu-id="46ac6-145">标有“重复”的箭头表明这是一个迭代过程，即随着新数据进入并且条件发生变化，我们不断重新定型模型的过程。</span><span class="sxs-lookup"><span data-stu-id="46ac6-145">The arrow labeled “repeat” suggests that this is an iterative process – one where we are continuously re-training the models as fresh data comes in and conditions change.</span></span> <span data-ttu-id="46ac6-146">此循环何时需要重复以及重复的频率取决于实现的具体条件，并且需要仔细监测先前生成的模型的性能，以预测在模型“老化”或“降级”时要检测的故障。</span><span class="sxs-lookup"><span data-stu-id="46ac6-146">When and how often this loop needs to repeat depends on the specific conditions of the implementation and requires careful monitoring of the performance of the previously built models in predicting failures to detect when models are “aging” or “degrading”.</span></span>

<span data-ttu-id="46ac6-147">继续定型新模型并部署它们还会在管理它们时面临新挑战。</span><span class="sxs-lookup"><span data-stu-id="46ac6-147">Continuously training new models and deploying them also brings in the challenge for managing them.</span></span> <span data-ttu-id="46ac6-148">Microsoft 为模型的 CI/CD（持续集成和持续交付）提供 Azure 机器学习模型管理服务。</span><span class="sxs-lookup"><span data-stu-id="46ac6-148">Microsoft offers Azure Machine Learning Model Management service for the CI/CD (continuous integration and continuous delivery) of models.</span></span>

![机器学习模型生成阶段](assets/pdm-assets/mlmodelbuildingstages.png)

<span data-ttu-id="46ac6-150">Microsoft 已发布有关如何准备数据和训练机器学习模型的[详细指南](https://docs.microsoft.com/en-us/azure/machine-learning/team-data-science-process/cortana-analytics-playbook-predictive-maintenance?WT.mc_id=pdmsolution-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="46ac6-150">Microsoft has published [a detailed guide](https://docs.microsoft.com/en-us/azure/machine-learning/team-data-science-process/cortana-analytics-playbook-predictive-maintenance?WT.mc_id=pdmsolution-docs-ercenk) on how to prepare the data and train the machine learning model.</span></span> <span data-ttu-id="46ac6-151">存在三个典型维护问题以及相关的机器学习算法：</span><span class="sxs-lookup"><span data-stu-id="46ac6-151">There are three typical maintenance questions, and the related machine learning algorithms:</span></span>

- <span data-ttu-id="46ac6-152">_对于资产，在接下来的 X 小时内发生故障的概率是多少？_</span><span class="sxs-lookup"><span data-stu-id="46ac6-152">_For the asset, what is the probability that a failure will occur within the next X hours?_</span></span> <span data-ttu-id="46ac6-153">回答：0-100%</span><span class="sxs-lookup"><span data-stu-id="46ac6-153">Answer: 0-100%</span></span>
  - <span data-ttu-id="46ac6-154">**二进制分类：** 二进制分类是一种机器学习方法，它使用数据将项目或数据行的类别、类型或类确定为两个类之一的成员。</span><span class="sxs-lookup"><span data-stu-id="46ac6-154">**Binary classification:** Binary classification is a machine learning method that uses data to determine the category, type, or class of an item or row of data, as a member of one of the two classes.</span></span> <span data-ttu-id="46ac6-155">有多种类型的分类算法，Microsoft 发布了一组可用作[机器学习工作室模块](https://docs.microsoft.com/en-us/azure/machine-learning/studio-module-reference/machine-learning-initialize-model-classification?WT.mc_id=pdmsolution-docs-ercenk)的算法。</span><span class="sxs-lookup"><span data-stu-id="46ac6-155">There are multiple types of classification algorithms, Microsoft published a set of algorithms available as [Machine Learning Studio modules](https://docs.microsoft.com/en-us/azure/machine-learning/studio-module-reference/machine-learning-initialize-model-classification?WT.mc_id=pdmsolution-docs-ercenk).</span></span>
- <span data-ttu-id="46ac6-156">_资产的剩余使用寿命是多少？_</span><span class="sxs-lookup"><span data-stu-id="46ac6-156">_What is the remaining useful life of the asset?_</span></span> <span data-ttu-id="46ac6-157">回答：X 小时</span><span class="sxs-lookup"><span data-stu-id="46ac6-157">Answer: X hours</span></span>
  - <span data-ttu-id="46ac6-158">回归：回归是一类机器学习算法，在给定一组其他变量的情况下预测变量的值。</span><span class="sxs-lookup"><span data-stu-id="46ac6-158">**Regression:** Regression is a class of machine learning algorithms that predict the value of a variable, given a set of other variables.</span></span> <span data-ttu-id="46ac6-159">机器学习工作室包括一组作为[模块](https://docs.microsoft.com/en-us/azure/machine-learning/studio-module-reference/machine-learning-initialize-model-regression?WT.mc_id=pdmsolution-docs-ercenk)的回归算法。</span><span class="sxs-lookup"><span data-stu-id="46ac6-159">Machine Learning Studio includes a set of regression algorithms as [modules](https://docs.microsoft.com/en-us/azure/machine-learning/studio-module-reference/machine-learning-initialize-model-regression?WT.mc_id=pdmsolution-docs-ercenk).</span></span>
    - <span data-ttu-id="46ac6-160">长短时记忆 (LSTM)：[LSTM](http://colah.github.io/posts/2015-08-Understanding-LSTMs/?WT.mc_id=pdmsolution-docs-ercenk) 网络是一种深度神经网络 (DNN)。</span><span class="sxs-lookup"><span data-stu-id="46ac6-160">**Long Short Term Memory (LSTM):** [LSTM](http://colah.github.io/posts/2015-08-Understanding-LSTMs/?WT.mc_id=pdmsolution-docs-ercenk) networks are a type of deep neural networks (DNN).</span></span> <span data-ttu-id="46ac6-161">DNN 的灵感来自于模拟大脑中个体神经元的行为。</span><span class="sxs-lookup"><span data-stu-id="46ac6-161">Inspiration of DNNs comes from modelling the behavior of individual neurons in the brain.</span></span> <span data-ttu-id="46ac6-162">Microsoft 已发布了用于介绍如何使用 LSTM 进行预测性维护的[分步指南](https://docs.microsoft.com/en-us/azure/machine-learning/desktop-workbench/scenario-deep-learning-for-predictive-maintenance?WT.mc_id=pdmsolution-docs-ercenk)</span><span class="sxs-lookup"><span data-stu-id="46ac6-162">Microsoft has published a [step-by-step guide](https://docs.microsoft.com/en-us/azure/machine-learning/desktop-workbench/scenario-deep-learning-for-predictive-maintenance?WT.mc_id=pdmsolution-docs-ercenk) for describing on using an LSTM for Predictive Maintenance</span></span>
- <span data-ttu-id="46ac6-163">_哪种资产最急需服务？_</span><span class="sxs-lookup"><span data-stu-id="46ac6-163">_Which asset requires servicing most urgently?_</span></span> <span data-ttu-id="46ac6-164">回答：资产 X</span><span class="sxs-lookup"><span data-stu-id="46ac6-164">Answer: Asset X</span></span>
  - <span data-ttu-id="46ac6-165">多类分类：多类分类是一种机器学习方法，它使用数据将项目或数据行的类别、类型或类确定为多于两个类的成员。</span><span class="sxs-lookup"><span data-stu-id="46ac6-165">**Multi-class classification:** Multi-class classification is a machine learning method that uses data to determine the category, type, or class of an item or row of data, as a member of more than two classes.</span></span>

<span data-ttu-id="46ac6-166">同样，引入数据可能意味着利用多个通道，首先批量初始化它，然后继续接收流数据以预测故障，同时将其用于模型的后续生成。</span><span class="sxs-lookup"><span data-stu-id="46ac6-166">Again, bringing in the data may mean utilizing multiple channels, initializing it first in bulk, and then continue receiving streaming data for predicting failures, also using it for subsequent builds of the model.</span></span>

## <a name="bringing-data-to-azure"></a><span data-ttu-id="46ac6-167">将数据引入 Azure</span><span class="sxs-lookup"><span data-stu-id="46ac6-167">Bringing Data to Azure</span></span>

<span data-ttu-id="46ac6-168">Microsoft Azure 提供用于引入和存储数据的各种服务。</span><span class="sxs-lookup"><span data-stu-id="46ac6-168">Microsoft Azure provides variety services for ingesting and storing the data.</span></span> <span data-ttu-id="46ac6-169">我们建议使用批处理方法将数据传输到 Azure（如果尚未存在）。</span><span class="sxs-lookup"><span data-stu-id="46ac6-169">We recommend batch methods for getting the data transferred to Azure if it is not already there.</span></span> <span data-ttu-id="46ac6-170">如果可以将数据作为文件导出为已知格式（例如 csv、json、xml 等），这些都是不错的选择。</span><span class="sxs-lookup"><span data-stu-id="46ac6-170">If you can export your data as files into well-known formats, such as csv, json, xml etc. these are good options.</span></span> <span data-ttu-id="46ac6-171">你也可以选择在上传之前压缩它们，并在云端进一步处理它们。</span><span class="sxs-lookup"><span data-stu-id="46ac6-171">You may also choose to compress them before uploading, and further process them on the cloud side.</span></span>

- <span data-ttu-id="46ac6-172">使用 [AzCopy](https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy?WT.mc_id=pdmsolution-docs-ercenk) 上传到 blob 存储（适用于 Windows 和 Linux）</span><span class="sxs-lookup"><span data-stu-id="46ac6-172">Upload using   [AzCopy](https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy?WT.mc_id=pdmsolution-docs-ercenk) to blob storage (both Windows and Linux)</span></span>

- <span data-ttu-id="46ac6-173">[将 Blob 存储装载为](https://docs.microsoft.com/en-us/azure/storage/blobs/storage-how-to-mount-container-linux?WT.mc_id=pdmsolution-docs-ercenk) Linux 上的文件系统</span><span class="sxs-lookup"><span data-stu-id="46ac6-173">[Mount blob   storage](https://docs.microsoft.com/en-us/azure/storage/blobs/storage-how-to-mount-container-linux?WT.mc_id=pdmsolution-docs-ercenk) as a file system on Linux</span></span>

- <span data-ttu-id="46ac6-174">使用[导入/导出服务](https://docs.microsoft.com/en-us/azure/storage/common/storage-import-export-service?WT.mc_id=pdmsolution-docs-ercenk)，如果数据量很大，则上传时间会很长</span><span class="sxs-lookup"><span data-stu-id="46ac6-174">Use [Import/Export   service](https://docs.microsoft.com/en-us/azure/storage/common/storage-import-export-service?WT.mc_id=pdmsolution-docs-ercenk),   if the data size is big, and takes too much time to upload</span></span>

- <span data-ttu-id="46ac6-175">在 Windows、Linux 和 MacOS 上[装载 Azure 文件](https://docs.microsoft.com/en-us/azure/storage/files/storage-how-to-use-files-windows?WT.mc_id=pdmsolution-docs-ercenk)共享</span><span class="sxs-lookup"><span data-stu-id="46ac6-175">[Mount an Azure   File](https://docs.microsoft.com/en-us/azure/storage/files/storage-how-to-use-files-windows?WT.mc_id=pdmsolution-docs-ercenk) share on Windows, Linux and MacOS</span></span>

<span data-ttu-id="46ac6-176">如果数据位于 SQL Server 数据库中，你还可以使用[数据迁移助手](https://docs.microsoft.com/en-us/sql/dma/dma-overview?WT.mc_id=pdmsolution-docs-ercenk)将数据上传到 Azure SQL 数据库。</span><span class="sxs-lookup"><span data-stu-id="46ac6-176">If the data is in a SQL Server database, you can also use [Data Migration Assistant](https://docs.microsoft.com/en-us/sql/dma/dma-overview?WT.mc_id=pdmsolution-docs-ercenk) to upload the data to an Azure SQL Database.</span></span>

<span data-ttu-id="46ac6-177">Azure 平台上有各种用于提取、转换和加载 (ETL) 操作的工具和服务。</span><span class="sxs-lookup"><span data-stu-id="46ac6-177">There are a variety of tools and services on the Azure platform for Extract, Transform and Load (ETL) operations.</span></span> <span data-ttu-id="46ac6-178">最突出的服务是 [Azure 数据工厂](https://docs.microsoft.com/en-us/azure/data-factory/?WT.mc_id=pdmsolution-docs-ercenk)，它提供了一整套用于处理数据的功能。</span><span class="sxs-lookup"><span data-stu-id="46ac6-178">The most prominent service is the [Azure Data Factory](https://docs.microsoft.com/en-us/azure/data-factory/?WT.mc_id=pdmsolution-docs-ercenk) , which provides a full set of features for manipulating data.</span></span> <span data-ttu-id="46ac6-179">Azure 上的许多 ML 服务通过开放源代码库提供用于操作数据的其他选项。</span><span class="sxs-lookup"><span data-stu-id="46ac6-179">Other options for manipulating data are present in the many ML services available on Azure through the open source libraries.</span></span>

<span data-ttu-id="46ac6-180">至于定型 ML 模式，Microsoft Azure 提供了许多选项，所有选项都可以以不同的组合使用。</span><span class="sxs-lookup"><span data-stu-id="46ac6-180">As for training the ML mode, Microsoft Azure provides many options, which all can be used in different combinations.</span></span>

- [<span data-ttu-id="46ac6-181">Azure 机器学习服务</span><span class="sxs-lookup"><span data-stu-id="46ac6-181">Azure Machine Learning   Services</span></span>](https://docs.microsoft.com/en-us/azure/machine-learning/preview/?WT.mc_id=pdmsolution-docs-ercenk)

- [<span data-ttu-id="46ac6-182">Azure 机器学习工作室</span><span class="sxs-lookup"><span data-stu-id="46ac6-182">Azure Machine Learning   Studio</span></span>](https://docs.microsoft.com/en-us/azure/machine-learning/studio/?WT.mc_id=pdmsolution-docs-ercenk)

- [<span data-ttu-id="46ac6-183">Data Science Virtual Machine</span><span class="sxs-lookup"><span data-stu-id="46ac6-183">Data Science Virtual   Machine</span></span>](https://docs.microsoft.com/en-us/azure/machine-learning/data-science-virtual-machine/?WT.mc_id=pdmsolution-docs-ercenk)

- [<span data-ttu-id="46ac6-184">HDInsight 中的 Spark MLLib</span><span class="sxs-lookup"><span data-stu-id="46ac6-184">Spark MLLib in   HDInsight</span></span>](https://docs.microsoft.com/en-us/azure/hdinsight/spark/apache-spark-machine-learning-mllib-ipython?WT.mc_id=pdmsolution-docs-ercenk)

- [<span data-ttu-id="46ac6-185">Batch AI 定型服务</span><span class="sxs-lookup"><span data-stu-id="46ac6-185">Batch AI Training   Service</span></span>](https://docs.microsoft.com/en-us/azure/batch-ai/?WT.mc_id=pdmsolution-docs-ercenk)

<span data-ttu-id="46ac6-186">决定使用哪种工具取决于操作的复杂性、团队经验以及数据的大小。</span><span class="sxs-lookup"><span data-stu-id="46ac6-186">Deciding which tool to use depends on the complexity of the operations, the team’s experience, and the size of the data.</span></span>

<span data-ttu-id="46ac6-187">除了云服务成本之外，云解决方案的成本公式还包含许多变量，例如额外的工程、管理、数据传输费用等。在评估成本时使用这些变量，然后做出明智决定。</span><span class="sxs-lookup"><span data-stu-id="46ac6-187">The cost equation on cloud solutions contain many variables, in addition to the cloud service costs, such as additional engineering, administration, data transfers etc. Use these variables when assessing the cost, and make an informed decision.</span></span> <span data-ttu-id="46ac6-188">仅服务不构成总成本公式。</span><span class="sxs-lookup"><span data-stu-id="46ac6-188">Services only do not make up the total cost equation.</span></span>

<span data-ttu-id="46ac6-189">设计用于分析数据和发布模型的过程是详细主题，并且根据所使用的技术而不同。</span><span class="sxs-lookup"><span data-stu-id="46ac6-189">Designing the process for analyzing the data and publishing the model are detailed subjects and differ by the technologies used.</span></span> <span data-ttu-id="46ac6-190">这些主题超出了本文的范围。</span><span class="sxs-lookup"><span data-stu-id="46ac6-190">Those topics are outside the scope of this article.</span></span> <span data-ttu-id="46ac6-191">介绍流程的一系列文章以及可用于生成模型的 Azure 服务可用。</span><span class="sxs-lookup"><span data-stu-id="46ac6-191">A series of articles explaining the process and the Azure services that can be used in generating the model are available.</span></span> <span data-ttu-id="46ac6-192">Microsoft 还提供了一种用于生成解决方案的系统化方法，使数据科学团队能够在数据生命周期内有效协作。</span><span class="sxs-lookup"><span data-stu-id="46ac6-192">Microsoft also provides a systematic approach for building solutions that enables teams of data scientists to collaborate effectively over the lifecycle of the data.</span></span>

<span data-ttu-id="46ac6-193">Microsoft [机器学习文档](https://docs.microsoft.com/en-us/azure/machine-learning?WT.mc_id=pdmsolution-docs-ercenk)是探索生成、部署和管理 ML 和到云的 AI 模型选项的良好起点。</span><span class="sxs-lookup"><span data-stu-id="46ac6-193">Microsoft’s [Machine Learning documentation](https://docs.microsoft.com/en-us/azure/machine-learning?WT.mc_id=pdmsolution-docs-ercenk) is a good starting point for exploring the options for building, deploying and managing ML and AI models to the cloud.</span></span>

<span data-ttu-id="46ac6-194">Microsoft Azure 平台为按比例处理数据并生成 ML 模型提供了丰富的选择。</span><span class="sxs-lookup"><span data-stu-id="46ac6-194">The Microsoft Azure platform offers abundant choices for processing data in scale and building ML models.</span></span> <span data-ttu-id="46ac6-195">云平台上几乎可无限缩放的的计算和存储功能使生成 ML 和 AI 模型成为可能。</span><span class="sxs-lookup"><span data-stu-id="46ac6-195">The availability of almost endless, scalable compute and storage power on the cloud platforms enable building ML and AI models.</span></span> <span data-ttu-id="46ac6-196">因此，使用 Azure 服务生成模型是实现此数据流的最合理选择。</span><span class="sxs-lookup"><span data-stu-id="46ac6-196">Thus, using Azure services for building the models is the most logical option for implementing this data flow.</span></span>

## <a name="using-the-model"></a><span data-ttu-id="46ac6-197">使用模型</span><span class="sxs-lookup"><span data-stu-id="46ac6-197">Using the Model</span></span>

<span data-ttu-id="46ac6-198">一旦有了 ML 模型，我们就需要一种消耗它（或“使用”它）的机制来预测设备维护的需要。</span><span class="sxs-lookup"><span data-stu-id="46ac6-198">Once we have an ML model we need a mechanism for consuming it (or “using” it) to predict the need for maintenance of the equipment.</span></span> <span data-ttu-id="46ac6-199">在从设备接收到数据之后，它通过处理层移动以预测未来的故障情况，并为维护团队提供要采取的各种方式。</span><span class="sxs-lookup"><span data-stu-id="46ac6-199">After the data is received from the equipment, it moves through a processing layer to predict future failure cases and present various means for the maintenance teams to act.</span></span>

![使用模型](assets/pdm-assets/usingthemodel.png)

<span data-ttu-id="46ac6-201">联机时通过将实时传感器数据流式传输到解决方案或脱机时通过定期将传感器数据导入到解决方案可完成数据引入。</span><span class="sxs-lookup"><span data-stu-id="46ac6-201">Ingesting the data can be done either online by streaming the live sensor data into the solution, or offline by periodically importing the sensor data into the solution.</span></span>

<span data-ttu-id="46ac6-202">Microsoft Azure 平台提供了各种用于引入、处理和存储数据的服务，例如：</span><span class="sxs-lookup"><span data-stu-id="46ac6-202">Microsoft Azure platform provides a variety of services for ingesting, processing and storing the data, such as:</span></span>

- [<span data-ttu-id="46ac6-203">Azure 事件中心</span><span class="sxs-lookup"><span data-stu-id="46ac6-203">Azure Event   Hubs</span></span>](https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-what-is-event-hubs?WT.mc_id=pdmsolution-docs-ercenk)

- [<span data-ttu-id="46ac6-204">Azure 服务总线</span><span class="sxs-lookup"><span data-stu-id="46ac6-204">Azure Service   Bus</span></span>](https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview?WT.mc_id=pdmsolution-docs-ercenk)

- [<span data-ttu-id="46ac6-205">Azure IoT 中心</span><span class="sxs-lookup"><span data-stu-id="46ac6-205">Azure IoT   Hub</span></span>](https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-what-is-iot-hub?WT.mc_id=pdmsolution-docs-ercenk)

- [<span data-ttu-id="46ac6-206">Apache Kafka for HDInsight</span><span class="sxs-lookup"><span data-stu-id="46ac6-206">Apache Kafka for   HDInsight</span></span>](https://docs.microsoft.com/en-us/azure/hdinsight/kafka/apache-kafka-introduction?WT.mc_id=pdmsolution-docs-ercenk)

<span data-ttu-id="46ac6-207">与生成 ML 模型的过程不同，使用它不需要大量计算资源。</span><span class="sxs-lookup"><span data-stu-id="46ac6-207">Unlike the process of building the ML model, consuming it does not require a lot of computational resources.</span></span> <span data-ttu-id="46ac6-208">根据需要，可以将模型部署到云中的服务，或部署到本地工厂车间。</span><span class="sxs-lookup"><span data-stu-id="46ac6-208">Depending on your needs, the model can be deployed to a service in the cloud, or locally on the factory floor.</span></span>

<span data-ttu-id="46ac6-209">ML 模型的执行位置有两种主要替代方案，仅限本地或云。</span><span class="sxs-lookup"><span data-stu-id="46ac6-209">There are two main alternatives for where the ML model is executed, locally or cloud only.</span></span>

## <a name="local-execution"></a><span data-ttu-id="46ac6-210">本地执行</span><span class="sxs-lookup"><span data-stu-id="46ac6-210">Local Execution</span></span>

<span data-ttu-id="46ac6-211">ML 模型在本地使用，而数据则发送到云以供引入、存储和进一步处理。</span><span class="sxs-lookup"><span data-stu-id="46ac6-211">The ML model is consumed locally, while data is sent to the cloud for ingestion, storage, and further processing.</span></span> <span data-ttu-id="46ac6-212">此选项非常适合早期检测至关重要的场景。</span><span class="sxs-lookup"><span data-stu-id="46ac6-212">This option is well suited for scenarios where early detection is critical.</span></span>

![本地执行](assets/pdm-assets/localandcloud.png)

## <a name="cloud-execution"></a><span data-ttu-id="46ac6-214">云执行</span><span class="sxs-lookup"><span data-stu-id="46ac6-214">Cloud Execution</span></span>

<span data-ttu-id="46ac6-215">ML 模型的引入、处理、存储和执行都可以在 Azure 云中进行。</span><span class="sxs-lookup"><span data-stu-id="46ac6-215">Ingestion, process and storage, and execution of the ML model can all take place in the Azure cloud.</span></span> <span data-ttu-id="46ac6-216">当在多个租户或地理区域之间共享 ML 模型执行结果并且延迟并不重要时，此选项可能更适合。</span><span class="sxs-lookup"><span data-stu-id="46ac6-216">This option may be better suited in cases where when sharing the results of the execution of the ML model amongst multiple tenants or geographies (and latency is not critical).</span></span> <span data-ttu-id="46ac6-217">按照称为[“代表”模式](https://docs.microsoft.com/en-us/azure/architecture/patterns/ambassador?WT.mc_id=pdmsolution-docs-ercenk)的模式，可以在本地添加一个可选组件（通常称为“边缘网关”）来执行某些工作，例如数据聚合和投影、流分析等。</span><span class="sxs-lookup"><span data-stu-id="46ac6-217">An optional component, often referred to as “edge gateway” can be added locally to perform some of the work - such as data aggregation and projection, stream analytics, etc., following a pattern known as the [“Ambassador” pattern](https://docs.microsoft.com/en-us/azure/architecture/patterns/ambassador?WT.mc_id=pdmsolution-docs-ercenk).</span></span>

<span data-ttu-id="46ac6-218">在 Azure 上使用该模型有多种方法。</span><span class="sxs-lookup"><span data-stu-id="46ac6-218">There are multiple ways for using the model on Azure.</span></span> <span data-ttu-id="46ac6-219">[Azure 机器学习 Web 服务](https://docs.microsoft.com/en-us/azure/machine-learning/studio/consume-web-services?WT.mc_id=pdmsolution-docs-ercenk)是最直接的方法，并使用 [Azure 机器学习工作室](https://docs.microsoft.com/en-us/azure/machine-learning/studio/what-is-ml-studio?WT.mc_id=pdmsolution-docs-ercenk)作为创建模型的选择。</span><span class="sxs-lookup"><span data-stu-id="46ac6-219">[Azure Machine Learning Web service](https://docs.microsoft.com/en-us/azure/machine-learning/studio/consume-web-services?WT.mc_id=pdmsolution-docs-ercenk) is the most straightforward and uses [Azure Machine Learning Studio](https://docs.microsoft.com/en-us/azure/machine-learning/studio/what-is-ml-studio?WT.mc_id=pdmsolution-docs-ercenk) as the choice for creating the model.</span></span> <span data-ttu-id="46ac6-220">还可以选择 [Azure 机器学习模型管理](https://docs.microsoft.com/en-us/azure/machine-learning/preview/model-management-overview?WT.mc_id=pdmsolution-docs-ercenk)方法，它提供了一整套用于管理模型的服务，并提供 REST API 端点，具有身份验证、负载均衡、自动横向扩展和加密功能。</span><span class="sxs-lookup"><span data-stu-id="46ac6-220">One could also choose [Azure Machine Learning Model Management](https://docs.microsoft.com/en-us/azure/machine-learning/preview/model-management-overview?WT.mc_id=pdmsolution-docs-ercenk) which provides a comprehensive set of services for managing models, and provides REST API endpoints, with authentication, load balancing, automatic scale-out and encryption features.</span></span> <span data-ttu-id="46ac6-221">该模型可以部署到单台计算机（例如 Data Science Virtual Machine、IoT 设备、本地 PC）或 [Azure 容器服务](https://docs.microsoft.com/en-us/azure/aks/intro-kubernetes?WT.mc_id=pdmsolution-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="46ac6-221">The model can be deployed to single machine (e.g. Data Science Virtual Machine, an IoT device, a local PC) or [Azure Container Service](https://docs.microsoft.com/en-us/azure/aks/intro-kubernetes?WT.mc_id=pdmsolution-docs-ercenk).</span></span> <span data-ttu-id="46ac6-222">一旦通过 REST API 公开此模型，从自定义应用程序到企业解决方案集成，它的用途是无穷无尽的。</span><span class="sxs-lookup"><span data-stu-id="46ac6-222">Once the model is exposed through a REST API, the possibilities for using it are endless, from custom applications to enterprise solution integration.</span></span>

![仅限云](assets/pdm-assets/cloudonly.png)

<span data-ttu-id="46ac6-224">仅限云的部署并不一定意味着仅存在数据实时流式传输。</span><span class="sxs-lookup"><span data-stu-id="46ac6-224">A cloud-only deployment does not necessarily mean there will be live steaming of data only.</span></span> <span data-ttu-id="46ac6-225">潜在策略是定期从本地系统（例如，历史库或 MES）导出数据，将其导入云系统，并呈现结果。</span><span class="sxs-lookup"><span data-stu-id="46ac6-225">A potential strategy is to periodically export data from a local system (for example, a historian or MES), import it into the cloud system, and present the outcome.</span></span> <span data-ttu-id="46ac6-226">当设备无法将数据直接推送到系统、现有系统已经在收集数据或者不需要准实时数据处理时，此选项可能是一种可行的方法。</span><span class="sxs-lookup"><span data-stu-id="46ac6-226">This option may be a feasible approach when devices are not capable of pushing data directly into the system, existing systems are already collecting data, or no near-real-time data processing is necessary.</span></span> <span data-ttu-id="46ac6-227">在这些情况下，无需考虑边缘网关。</span><span class="sxs-lookup"><span data-stu-id="46ac6-227">In these cases, there is no need to consider an edge gateway.</span></span>

## <a name="predictive-maintenance-in-the-iot-context"></a><span data-ttu-id="46ac6-228">IoT 上下文中的预测性维护</span><span class="sxs-lookup"><span data-stu-id="46ac6-228">Predictive Maintenance in the IoT Context</span></span>

<span data-ttu-id="46ac6-229">许多 IoT 解决方案都会将数据作为其功能集的一部分进行引入和存储。</span><span class="sxs-lookup"><span data-stu-id="46ac6-229">Many IoT solutions ingest and store data as part of their feature set.</span></span> <span data-ttu-id="46ac6-230">由于预测性维护解决方案通常依赖于 IoT 数据，因此它们可以成为添加到 IoT 解决方案的自然功能。</span><span class="sxs-lookup"><span data-stu-id="46ac6-230">And as predictive maintenance solutions often rely on IoT data, they can be a natural feature add to IoT solutions.</span></span> <span data-ttu-id="46ac6-231">在这种情况下要强调的一个关键点是，记录现有数据中的故障以定型故障的预测模型的重要性。</span><span class="sxs-lookup"><span data-stu-id="46ac6-231">A crucial point to highlight in this context is the importance of having recorded failures in the existing data to train a predictive model for the failures.</span></span>

<span data-ttu-id="46ac6-232">一些用例需要进行准实时数据处理。</span><span class="sxs-lookup"><span data-stu-id="46ac6-232">Some use cases require near-real-time data processing.</span></span> <span data-ttu-id="46ac6-233">在这些情况下，我们需要具有高数据引入率功能的可缩放 IoT 解决方案。</span><span class="sxs-lookup"><span data-stu-id="46ac6-233">In these cases, we need a scalable IoT solution with high data ingestion rate capabilities.</span></span> <span data-ttu-id="46ac6-234">Microsoft Azure 平台提供了许多服务，以便为可高度缩放的 IoT 需求提供解决方案。</span><span class="sxs-lookup"><span data-stu-id="46ac6-234">The Microsoft Azure platform provides many services that can enable solutions for highly scalable IoT needs.</span></span> <span data-ttu-id="46ac6-235">Azure 平台上的 [Microsoft IoT 解决方案体系结构](https://docs.microsoft.com/en-us/azure/iot-suite/iot-suite-what-is-azure-iot?WT.mc_id=pdmsolution-docs-ercenk)在三个阶段具有逻辑组件：</span><span class="sxs-lookup"><span data-stu-id="46ac6-235">[Microsoft’s IoT solution architecture](https://docs.microsoft.com/en-us/azure/iot-suite/iot-suite-what-is-azure-iot?WT.mc_id=pdmsolution-docs-ercenk) on the Azure platform has logical components on three stages:</span></span>

- <span data-ttu-id="46ac6-236">设备连接</span><span class="sxs-lookup"><span data-stu-id="46ac6-236">Device connectivity</span></span>

- <span data-ttu-id="46ac6-237">数据处理和分析</span><span class="sxs-lookup"><span data-stu-id="46ac6-237">Data processing and analytics</span></span>

- <span data-ttu-id="46ac6-238">呈现</span><span class="sxs-lookup"><span data-stu-id="46ac6-238">Presentation</span></span>

![IoT 解决方案体系结构](assets/pdm-assets/iot.png)

<span data-ttu-id="46ac6-240">Azure IoT 解决方案体系结构的详细信息[可联机获取](http://download.microsoft.com/download/A/4/D/A4DAD253-BC21-41D3-B9D9-87D2AE6F0719/Microsoft_Azure_IoT_Reference_Architecture.pdf?WT.mc_id=pdmsolution-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="46ac6-240">The details of the Azure IoT Solution Architecture are [available online](http://download.microsoft.com/download/A/4/D/A4DAD253-BC21-41D3-B9D9-87D2AE6F0719/Microsoft_Azure_IoT_Reference_Architecture.pdf?WT.mc_id=pdmsolution-docs-ercenk).</span></span>
<span data-ttu-id="46ac6-241">但是，由于可能有大量设备连接到后端服务，因此可能会出现独特挑战。</span><span class="sxs-lookup"><span data-stu-id="46ac6-241">However, there are unique challenges that may arise due to the potentially substantial number of devices connecting to backend services.</span></span>

## <a name="data-ingestion-and-stream-processing"></a><span data-ttu-id="46ac6-242">数据引入和流式传输处理</span><span class="sxs-lookup"><span data-stu-id="46ac6-242">Data Ingestion and Stream Processing</span></span>

<span data-ttu-id="46ac6-243">从设备引入数据是两项单独服务之间的通信问题，即生成数据（设备）的系统和处理该数据的系统（即定型 ML 模型、针对定型模型运行传入数据点以预测剩余使用寿命）。</span><span class="sxs-lookup"><span data-stu-id="46ac6-243">Bringing in data from the devices is a problem of communication between two separate services; i.e. systems generating data (devices) and systems processing this data (i.e., training the ML model, running the incoming data points against the trained model to predict the remaining useful life).</span></span>

<span data-ttu-id="46ac6-244">根据定义，分布式系统由不同的组件组成，这些组件具有彼此通信的固有需求。</span><span class="sxs-lookup"><span data-stu-id="46ac6-244">Distributed systems, by definition, are composed of distinct components with an inherent need to communicate with each other.</span></span> <span data-ttu-id="46ac6-245">用于实现通信的一个选项可以是使相关组件彼此直接对话。</span><span class="sxs-lookup"><span data-stu-id="46ac6-245">One option for enabling communication can be having related components talking directly to each other.</span></span> <span data-ttu-id="46ac6-246">这将创建一个难以维护和缩放的系统。</span><span class="sxs-lookup"><span data-stu-id="46ac6-246">This creates a system that is hard to maintain and scale.</span></span> <span data-ttu-id="46ac6-247">随着组件数量的增加，它将产生通信链接的 _O(n<sup>2</sup>)_ 复杂性。</span><span class="sxs-lookup"><span data-stu-id="46ac6-247">As the number of components increase, it will create _O(n<sup>2</sup>)_ complexity of communication links.</span></span> <span data-ttu-id="46ac6-248">更好的方法是在公共集线器上发布和读取数据。</span><span class="sxs-lookup"><span data-stu-id="46ac6-248">A better approach is, where data is posted and read to and from a common hub.</span></span>

![子组件通信](./assets/pdm-assets/subcomponentcommunication.png)

<span data-ttu-id="46ac6-250">为数据引入注入新组件可使通信更具可缩放性。</span><span class="sxs-lookup"><span data-stu-id="46ac6-250">Injecting a new component for data ingestion makes the communication more scalable.</span></span> <span data-ttu-id="46ac6-251">该组件需要具有可缩放性、安全性并且大概可以进行全局访问，具有异地分区数据引入进程的选项。</span><span class="sxs-lookup"><span data-stu-id="46ac6-251">This component needs to be scalable, secure and most probably globally accessible, with the option of geo-partitioning the data ingestion process.</span></span> 

<span data-ttu-id="46ac6-252">考虑预测性维护是 IoT 解决方案的一个特征。</span><span class="sxs-lookup"><span data-stu-id="46ac6-252">Considering predictive maintenance is a feature of the IoT solution.</span></span> <span data-ttu-id="46ac6-253">当数据流通过网关时，需要将其路由到与预测性维护功能相关的服务。</span><span class="sxs-lookup"><span data-stu-id="46ac6-253">As the data streams through the gateway, it needs to be routed to services related with predictive maintenance functionality.</span></span>
<span data-ttu-id="46ac6-254">另一种需要考虑的模式是[网关路由](https://docs.microsoft.com/en-us/azure/architecture/patterns/gateway-routing?WT.mc_id=pdmsolution-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="46ac6-254">Another pattern to consider is [Gateway Routing](https://docs.microsoft.com/en-us/azure/architecture/patterns/gateway-routing?WT.mc_id=pdmsolution-docs-ercenk).</span></span>

<span data-ttu-id="46ac6-255">这两种模式都可以使用 Azure 服务、[IoT 中心](https://azure.microsoft.com/en-us/services/iot-hub/?WT.mc_id=pdmsolution-docs-ercenk)和 [Azure 流分析](https://azure.microsoft.com/en-us/services/stream-analytics/?WT.mc_id=pdmsolution-docs-ercenk)来实现。</span><span class="sxs-lookup"><span data-stu-id="46ac6-255">Both patterns can be implemented using Azure service, [IoT Hub](https://azure.microsoft.com/en-us/services/iot-hub/?WT.mc_id=pdmsolution-docs-ercenk) and [Azure Stream Analytics](https://azure.microsoft.com/en-us/services/stream-analytics/?WT.mc_id=pdmsolution-docs-ercenk).</span></span>

## <a name="edge-and-cloud-processing-cooperation"></a><span data-ttu-id="46ac6-256">Edge 和云处理协作</span><span class="sxs-lookup"><span data-stu-id="46ac6-256">Edge and Cloud Processing Cooperation</span></span>

<span data-ttu-id="46ac6-257">并非所有设备和装置都可以直接稳定地访问互联网。</span><span class="sxs-lookup"><span data-stu-id="46ac6-257">Not all devices and equipment can access the internet directly and consistently.</span></span>
<span data-ttu-id="46ac6-258">有时它们的数据需要从通用网关中拉取出来。</span><span class="sxs-lookup"><span data-stu-id="46ac6-258">Sometimes their data needs to be pulled out from a common gateway.</span></span> <span data-ttu-id="46ac6-259">例如，[MTConnect](http://www.mtconnect.org/) 代理仅提供用于拉取数据的 REST 接口。</span><span class="sxs-lookup"><span data-stu-id="46ac6-259">For example, [MTConnect](http://www.mtconnect.org/) agents only provide a REST interface for pulling data out.</span></span>

<span data-ttu-id="46ac6-260">可能存在其他考虑因素，例如延迟，在将设备数据发送到云之前需要在本地推移设备数据（多租户情况），以及需要对设备数据执行投影或聚合。</span><span class="sxs-lookup"><span data-stu-id="46ac6-260">There can be other considerations such as latency, the need to scrub device data locally before sending it to the cloud (multitenant cases), and the need to perform projections or aggregations on device data.</span></span> <span data-ttu-id="46ac6-261">[代表模式](https://docs.microsoft.com/en-us/azure/architecture/patterns/ambassador?WT.mc_id=pdmsolution-docs-ercenk)是解决这些需求的好方法。</span><span class="sxs-lookup"><span data-stu-id="46ac6-261">The [Ambassador pattern](https://docs.microsoft.com/en-us/azure/architecture/patterns/ambassador?WT.mc_id=pdmsolution-docs-ercenk) is a good approach to address these needs.</span></span> <span data-ttu-id="46ac6-262">[Microsoft Azure IoT Edge](https://docs.microsoft.com/en-us/azure/iot-edge/how-iot-edge-works?WT.mc_id=pdmsolution-docs-ercenk) 是一种实现，可以充当 [Microsoft Azure IoT 中心](https://azure.microsoft.com/en-us/services/iot-hub/?WT.mc_id=pdmsolution-docs-ercenk)的代理，并提供本地处理及远程管理功能。</span><span class="sxs-lookup"><span data-stu-id="46ac6-262">[Microsoft Azure IoT Edge](https://docs.microsoft.com/en-us/azure/iot-edge/how-iot-edge-works?WT.mc_id=pdmsolution-docs-ercenk) is an implementation that can act as a proxy to [Microsoft Azure IoT Hub](https://azure.microsoft.com/en-us/services/iot-hub/?WT.mc_id=pdmsolution-docs-ercenk), as well as provide local processing capabilities with remote management.</span></span>

<span data-ttu-id="46ac6-263">常见部署包括车间的准实时警报，同时仍推移数据并将其发布到云中的多租户解决方案，以进行存档、模型定型和非时间关键报告。</span><span class="sxs-lookup"><span data-stu-id="46ac6-263">A common deployment may include near-real-time alerts on the shop floor, while still scrubbing and posting data to a multitenant solution in the cloud for archival, model training, and non-time-critical reporting.</span></span> <span data-ttu-id="46ac6-264">借助 Azure IoT Edge 和 IoT 中心的功能，客户可以控制边缘设备上的数据筛选选项，以及与其他车间系统交互以发送警报。</span><span class="sxs-lookup"><span data-stu-id="46ac6-264">With Azure IoT Edge and IoT Hub’s capabilities, customers can control the data-filtering options on the edge device, as well as interact with other shop-floor systems to deliver alerts.</span></span>

![多租户](assets/pdm-assets/multitenant.png)

## <a name="multitenant-perspective"></a><span data-ttu-id="46ac6-266">多租户角度</span><span class="sxs-lookup"><span data-stu-id="46ac6-266">Multitenant Perspective</span></span>

<span data-ttu-id="46ac6-267">如前所述，某些制造商或第三方可能希望为其客户提供预测性维护服务。</span><span class="sxs-lookup"><span data-stu-id="46ac6-267">As mentioned earlier, some manufacturers or third-parties may want to deliver predictive maintenance services to their customers.</span></span> <span data-ttu-id="46ac6-268">这些服务很可能会在多租户云部署中提供，这会带来一系列挑战：</span><span class="sxs-lookup"><span data-stu-id="46ac6-268">These services will most likely be offered in multitenant cloud deployments, which present their own set of challenges:</span></span>

### <a name="data-security-and-isolation"></a><span data-ttu-id="46ac6-269">数据安全性和独立性</span><span class="sxs-lookup"><span data-stu-id="46ac6-269">Data security and Isolation</span></span>

<span data-ttu-id="46ac6-270">提供服务的一方必须确保可识别并妥善保护或推移其客户的机密信息。Microsoft Azure 提供了根据所使用的存储服务加密数据的功能。</span><span class="sxs-lookup"><span data-stu-id="46ac6-270">The party providing a service must ensure confidential information from its customers is identified and properly secured or scrubbed out. Microsoft Azure provides capabilities for encrypting the data depending on the storage service used.</span></span>

<span data-ttu-id="46ac6-271">设备生成和提交数据的方式也需要使用已知方法进行保护，例如每设备证书、每设备启用/禁用、TLS 安全、X.509 支持、IP 允许列表/阻止列表以及共享访问策略。</span><span class="sxs-lookup"><span data-stu-id="46ac6-271">The way the devices generate and submit data also needs to be secured, using well known methods such as per-device certificates, per-device enable/disable, TLS security, X.509 support, IP whitelisting/blacklisting, and shared access policies.</span></span> <span data-ttu-id="46ac6-272">提供服务的一方必须确保可识别并妥善保护或推移客户的机密信息。[Azure Data Lake Store](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-encryption?WT.mc_id=pdmsolution-docs-ercenk)、[Azure 存储](https://docs.microsoft.com/en-us/azure/storage/common/storage-service-encryption?WT.mc_id=pdmsolution-docs-ercenk)、[Azure Cosmos DB](https://docs.microsoft.com/en-us/azure/cosmos-db/database-encryption-at-rest?WT.mc_id=pdmsolution-docs-ercenk) 和 [Azure SQL 数据库](https://docs.microsoft.com/en-us/sql/relational-databases/security/encryption/transparent-data-encryption-azure-sql?WT.mc_id=pdmsolution-docs-ercenk)是可用于加密静态数据的服务示例。</span><span class="sxs-lookup"><span data-stu-id="46ac6-272">The party providing a service must ensure confidential information from customers is identified and properly secured or scrubbed out. [Azure Data Lake Store](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-encryption?WT.mc_id=pdmsolution-docs-ercenk), [Azure Storage](https://docs.microsoft.com/en-us/azure/storage/common/storage-service-encryption?WT.mc_id=pdmsolution-docs-ercenk), [Azure Cosmos DB](https://docs.microsoft.com/en-us/azure/cosmos-db/database-encryption-at-rest?WT.mc_id=pdmsolution-docs-ercenk), and [Azure SQL Database](https://docs.microsoft.com/en-us/sql/relational-databases/security/encryption/transparent-data-encryption-azure-sql?WT.mc_id=pdmsolution-docs-ercenk) are examples of services that can be used for encrypting the data at rest.</span></span> <span data-ttu-id="46ac6-273">解决方案提供商还应考虑如何在同一资源（例如数据库）或多个资源内对数据进行分区。</span><span class="sxs-lookup"><span data-stu-id="46ac6-273">The solution providers should also consider how to partition the data either within the same resource (e.g. database) or multiple ones.</span></span> 

### <a name="geographical-considerations"></a><span data-ttu-id="46ac6-274">地理位置注意事项</span><span class="sxs-lookup"><span data-stu-id="46ac6-274">Geographical considerations</span></span>

<span data-ttu-id="46ac6-275">最有可能的情况是，生成数据的设备在地理上是分散的。</span><span class="sxs-lookup"><span data-stu-id="46ac6-275">Most likely, the devices generating data will be geographically dispersed.</span></span> <span data-ttu-id="46ac6-276">解决方案需要提供最接近数据源的引入点。</span><span class="sxs-lookup"><span data-stu-id="46ac6-276">The solution needs provide an ingestion point closest to the data source.</span></span> <span data-ttu-id="46ac6-277">有时可能会出现连续连接问题，并且必须批量引入数据，或者需要存在本地存储转发机制。</span><span class="sxs-lookup"><span data-stu-id="46ac6-277">There might also be times where continuous connectivity is an issue, and data may have to be ingested in bulk, or a local store-and-forward mechanism needs to be present.</span></span>

### <a name="scalability"></a><span data-ttu-id="46ac6-278">可伸缩性</span><span class="sxs-lookup"><span data-stu-id="46ac6-278">Scalability</span></span>

<span data-ttu-id="46ac6-279">生成 ML 模型需要可弹性缩放的计算资源。</span><span class="sxs-lookup"><span data-stu-id="46ac6-279">Building the ML models requires compute resources that can scale elastically.</span></span>
<span data-ttu-id="46ac6-280">解决方案提供商必须设计有效使用计算资源的进程，并使用进程按需缩放解决方案。</span><span class="sxs-lookup"><span data-stu-id="46ac6-280">The solution provider must devise processes that make effective use of compute resources and use the processes for scaling the solution on demand.</span></span>

### <a name="provisioning-tenants-and-secure-access"></a><span data-ttu-id="46ac6-281">预配租户和安全访问</span><span class="sxs-lookup"><span data-stu-id="46ac6-281">Provisioning Tenants and Secure Access</span></span>

<span data-ttu-id="46ac6-282">服务提供商需要设计有效加入新租户的方法，并为他们提供自己管理帐户的方法。</span><span class="sxs-lookup"><span data-stu-id="46ac6-282">The service provider needs to devise methods for effectively onboarding new tenants and giving them means for managing their accounts by themselves.</span></span> <span data-ttu-id="46ac6-283">作出部署到独占或共享资源决定时也是这样。</span><span class="sxs-lookup"><span data-stu-id="46ac6-283">This is also the when the decision on deployments to exclusive or shared resources are made.</span></span>


## <a name="pillars-of-software-quality-review"></a><span data-ttu-id="46ac6-284">软件质量评审的构成要素</span><span class="sxs-lookup"><span data-stu-id="46ac6-284">Pillars of Software Quality Review</span></span> 

<span data-ttu-id="46ac6-285">除了满足功能要求之外，复杂系统还需要进行额外的详细审查。</span><span class="sxs-lookup"><span data-stu-id="46ac6-285">Complex systems require additional scrutiny, other than fulfilling the functional requirements.</span></span> <span data-ttu-id="46ac6-286">一个成功的云解决方案应注重五大构成要素：可伸缩性、可用性、复原能力、管理和安全性。</span><span class="sxs-lookup"><span data-stu-id="46ac6-286">Successful cloud solutions focus on these five pillars, scalability, availability, resiliency, management, and security.</span></span> <span data-ttu-id="46ac6-287">除了五大构成要素外，我们还希望提高解决方案的成本效益。</span><span class="sxs-lookup"><span data-stu-id="46ac6-287">In addition to the five pillars, we also would like to bring the cost effectiveness of the solution.</span></span>

<span data-ttu-id="46ac6-288">有关详细信息，请参阅[软件质量的构成要素](https://docs.microsoft.com/en-us/azure/architecture/guide/pillars?WT.mc_id=pdmsolution-docs-ercenk)文章。</span><span class="sxs-lookup"><span data-stu-id="46ac6-288">Please see [Pillars of Software Quality](https://docs.microsoft.com/en-us/azure/architecture/guide/pillars?WT.mc_id=pdmsolution-docs-ercenk) article for the details.</span></span>

| <span data-ttu-id="46ac6-289">构成要素</span><span class="sxs-lookup"><span data-stu-id="46ac6-289">Pillar</span></span>                      |                                                                                                                                                                                                                                                                                                                                                                                                 |
|-----------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="46ac6-290">可伸缩性</span><span class="sxs-lookup"><span data-stu-id="46ac6-290">Scalability</span></span>                 | <span data-ttu-id="46ac6-291">大多数 Azure 服务都支持垂直和水平缩放选项。</span><span class="sxs-lookup"><span data-stu-id="46ac6-291">Most Azure services support vertical and horizontal scaling options.</span></span> <span data-ttu-id="46ac6-292">利用 Azure 平台上的资源按需部署功能，并通过自动化服务控制其规模（实例大小和数量）。</span><span class="sxs-lookup"><span data-stu-id="46ac6-292">Take advantage of on-demand deployment of resources on the Azure platform and control their scale (size and number of instances) via automated services.</span></span>                                                                                                                                                                   |
| <span data-ttu-id="46ac6-293">可用性和复原能力</span><span class="sxs-lookup"><span data-stu-id="46ac6-293">Availability and resiliency</span></span> | <span data-ttu-id="46ac6-294">可以使用许多 Azure 服务根据需要弹性预配计算和存储资源。</span><span class="sxs-lookup"><span data-stu-id="46ac6-294">Compute and storage resources can be provisioned as needed elastically using many Azure services.</span></span> <span data-ttu-id="46ac6-295">所有 Azure 服务都提供不同级别的 SLA，但是解决方案必须通过使用适当的设计原则来考虑和利用 SLA 级别。</span><span class="sxs-lookup"><span data-stu-id="46ac6-295">All of the Azure services provide various levels of SLAs, however the solutions must consider and utilize the SLA levels as appropriate by using proper design principles.</span></span>                                                                                                                    |
| <span data-ttu-id="46ac6-296">管理</span><span class="sxs-lookup"><span data-stu-id="46ac6-296">Management</span></span>                  | <span data-ttu-id="46ac6-297">可以通过各种方式部署和管理 Azure 资源，例如 ARM 模板、命令行工具、PowerShell cmdlet 以及 Azure 管理 API。</span><span class="sxs-lookup"><span data-stu-id="46ac6-297">Azure resources may be deployed and managed by various means, such as ARM templates, command line tools and PowerShell cmdlets, and Azure Management APIs.</span></span> <span data-ttu-id="46ac6-298">考虑在管理 Azure 资源时生成自动化解决方案，而不是使用带有 UI 的工具。</span><span class="sxs-lookup"><span data-stu-id="46ac6-298">Consider building automated solutions when managing Azure resources, instead of using tools with UIs.</span></span>                                                                                                                                |
| <span data-ttu-id="46ac6-299">安全</span><span class="sxs-lookup"><span data-stu-id="46ac6-299">Security</span></span>                    | <span data-ttu-id="46ac6-300">Azure IoT 中心支持 TLS 上的对称和非对称密钥（X509 证书和 TPM）。</span><span class="sxs-lookup"><span data-stu-id="46ac6-300">Azure IoT Hub supports symmetrical and asymmetrical keys (X509 certificates and TPM) over TLS.</span></span> <span data-ttu-id="46ac6-301">数据存储使用标识和访问管理 (IAM) 设置进行保护，它们还支持静态数据加密。</span><span class="sxs-lookup"><span data-stu-id="46ac6-301">The data stores are protected using Identity and Access Management (IAM) settings and they also support encryption of data at rest.</span></span> <span data-ttu-id="46ac6-302">作为常规高级安全清单，请考虑查看授权、身份验证、传输和静态加密以及审核机制。</span><span class="sxs-lookup"><span data-stu-id="46ac6-302">As a general high-level security checklist, consider reviewing the authorization, authentication, transport and at rest encryption, and auditing mechanisms.</span></span> |
| <span data-ttu-id="46ac6-303">经济高效</span><span class="sxs-lookup"><span data-stu-id="46ac6-303">Cost effective</span></span>              | <span data-ttu-id="46ac6-304">考虑在需要时预配资源，并在不使用时自动放弃资源。</span><span class="sxs-lookup"><span data-stu-id="46ac6-304">Consider provisioning resources when needed and discarding them when not in use by automation.</span></span>                                                                                                                                                                                                                                                                                                  |

## <a name="conclusion"></a><span data-ttu-id="46ac6-305">结束语</span><span class="sxs-lookup"><span data-stu-id="46ac6-305">Conclusion</span></span>

<span data-ttu-id="46ac6-306">预测性维护是长期以来一直在讨论的主题。</span><span class="sxs-lookup"><span data-stu-id="46ac6-306">Predictive maintenance has been a topic of discussion for a long time.</span></span> <span data-ttu-id="46ac6-307">云平台的最新发展（如 Microsoft Azure）使预测性维护的实施者能够克服过去在处理数据时成为阻碍的许多挑战。</span><span class="sxs-lookup"><span data-stu-id="46ac6-307">Recent developments in cloud platforms, like Microsoft Azure, enables implementers for predictive maintenance to overcome many challenges that were obstacles in the past when dealing with data.</span></span> <span data-ttu-id="46ac6-308">凭借计算和存储容量的弹性缩放，云平台为实施预测性维护提供了新的机会，同时提供了新的收益机遇。</span><span class="sxs-lookup"><span data-stu-id="46ac6-308">With the elastic scale on the compute and storage capacity, cloud platforms present new opportunities for implementing predictive maintenance, along with new revenue opportunities.</span></span> <span data-ttu-id="46ac6-309">Microsoft Azure 平台提供了许多不同功能的服务，以实现预测性维护解决方案的业务目标。</span><span class="sxs-lookup"><span data-stu-id="46ac6-309">Microsoft’s Azure platform provides many services of different capabilities for achieving business goals of a predictive maintenance solution.</span></span>

<span data-ttu-id="46ac6-310">本文提供了如何收集数据并定型数据模型，以及利用定型模型对前面部分中预测的结果采取操作的愿景。</span><span class="sxs-lookup"><span data-stu-id="46ac6-310">This article provided a vision for how to collect data and train data models, along with utilizing the trained model to take action on the outcomes predicted in the previous sections.</span></span>

## <a name="further-reading"></a><span data-ttu-id="46ac6-311">延伸阅读</span><span class="sxs-lookup"><span data-stu-id="46ac6-311">Further Reading</span></span>

1. [<span data-ttu-id="46ac6-312">面向未来：停止缅怀过去，并通过 IoT 展望不可预知的未来</span><span class="sxs-lookup"><span data-stu-id="46ac6-312">Future-focused: Stop thinking in the past and get ahead of the unexpected  with  IoT</span></span>](https://blogs.microsoft.com/iot/2017/02/28/future-focused-stop-thinking-in-the-past-and-get-ahead-of-the-unexpected-with-iot-2/?WT.mc_id=pdmsolution-docs-ercenk)

2. [<span data-ttu-id="46ac6-313">通过已启用 IoT 的预测性维护提高设备可靠性</span><span class="sxs-lookup"><span data-stu-id="46ac6-313">Boost equipment reliability with IoT-enabled predictive  maintenance</span></span>](https://www.microsoft.com/en-us/internet-of-things/predictive-maintenance?WT.mc_id=pdmsolution-docs-ercenk)

3. [<span data-ttu-id="46ac6-314">获取物联网的价值：如何处理预测性维护项目</span><span class="sxs-lookup"><span data-stu-id="46ac6-314">Capture value from the Internet of Things: How to approach a predictive  maintenance  project</span></span>](http://download.microsoft.com/download/0/7/D/07D394CE-185D-4B96-AC3C-9B61179F7080/Capture_value_from_the_Internet%20of%20Things_with_Predictive_Maintenance.PDF?WT.mc_id=pdmsolution-docs-ercenk)

4. [<span data-ttu-id="46ac6-315">合作伙伴透视：一线预测性维护</span><span class="sxs-lookup"><span data-stu-id="46ac6-315">Partner perspectives: Predictive maintenance on the  frontlines</span></span>](https://blogs.microsoft.com/iot/2017/03/21/partner-perspectives-predictive-maintenance-on-the-frontlines/?WT.mc_id=pdmsolution-docs-ercenk)

5. [<span data-ttu-id="46ac6-316">从商品化到服务化：转换业务，以便在新的现场服务时代通过 IoT 进行竞争</span><span class="sxs-lookup"><span data-stu-id="46ac6-316">From commoditization to servitization: Transforming your business to  compete in the new age of field service with  IoT</span></span>](https://blogs.microsoft.com/iot/2016/11/07/from-commodization-to-servitization-transforming-your-business-to-compete-in-the-new-age-of-field-service-with-iot/?WT.mc_id=pdmsolution-docs-ercenk)
