---
title: 用于从面向制造业的 IoT 提取见解的体系结构
description: 使用 Azure 服务从 IoT 数据中提取见解。
author: ercenk
ms.author: ercenk
manager: gmarchet
ms.service: industry
ms.topic: article
ms.date: 11/28/2019
ms.openlocfilehash: c08e6bbb1da47084122dae1ed6a9e1cea0b59473
ms.sourcegitcommit: db3bee67c1467884af223a48a895715afba8e08c
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/11/2019
ms.locfileid: "75005306"
---
# <a name="extracting-actionable-insights-from-iot-data"></a><span data-ttu-id="bca9e-103">从 IoT 数据中提取可操作见解</span><span class="sxs-lookup"><span data-stu-id="bca9e-103">Extracting actionable insights from IoT data</span></span>

<span data-ttu-id="bca9e-104">如果你负责工厂车间的机器，则应该知道物联网 (IoT) 是改进流程和结果的下一步。</span><span class="sxs-lookup"><span data-stu-id="bca9e-104">If you are responsible for the machines on a factory floor, you are already aware that the Internet of Things (IoT) is the next step in improving your processes and results.</span></span> <span data-ttu-id="bca9e-105">第一步是在机器上或工厂车间安装传感器。</span><span class="sxs-lookup"><span data-stu-id="bca9e-105">Having sensors on machines, or the factory floor, is the first step.</span></span> <span data-ttu-id="bca9e-106">下一步是使用数据，这是本文档的目标。</span><span class="sxs-lookup"><span data-stu-id="bca9e-106">The next step is to use the data—which is the object of this document.</span></span> <span data-ttu-id="bca9e-107">本指南从技术角度概述了从 IoT 数据分析中提取可操作见解所需的组件。</span><span class="sxs-lookup"><span data-stu-id="bca9e-107">This guide provides a technical overview of the components needed to extract actionable insights from IoT data analytics.</span></span>

<span data-ttu-id="bca9e-108">IoT 分析解决方案旨在将来自一组设备的原始 IoT 数据转换成更适合分析的形式。</span><span class="sxs-lookup"><span data-stu-id="bca9e-108">IoT analytics solutions are about transforming raw IoT data coming from a set of devices into a form that is better suited for analytics.</span></span> <span data-ttu-id="bca9e-109">一旦数据具有可分析的形式，我们便可以执行分析。</span><span class="sxs-lookup"><span data-stu-id="bca9e-109">Once the data is in an analyzable form we can actually perform analytics.</span></span> <span data-ttu-id="bca9e-110">一些分析示例包括：</span><span class="sxs-lookup"><span data-stu-id="bca9e-110">Some examples of analytics include:</span></span>

- <span data-ttu-id="bca9e-111">遥测数据的简单可视化，例如，显示温度随时间变化的条形图</span><span class="sxs-lookup"><span data-stu-id="bca9e-111">simple visualizations of the telemetry data, for example, a bar chart showing temperatures over time</span></span>
- <span data-ttu-id="bca9e-112">KPI 计算，例如，设备综合效率 (OEE)</span><span class="sxs-lookup"><span data-stu-id="bca9e-112">calculation of KPIs, for example, Overall Equipment Effectiveness (OEE)</span></span>
- <span data-ttu-id="bca9e-113">由机器学习模型提供支持的预测分析</span><span class="sxs-lookup"><span data-stu-id="bca9e-113">predictive analytics powered by machine learning models</span></span>

<span data-ttu-id="bca9e-114">这些分析反过来提供告知操作信息的见解。</span><span class="sxs-lookup"><span data-stu-id="bca9e-114">These analytics, in turn, provide insights that inform actions.</span></span> <span data-ttu-id="bca9e-115">操作范围包括向机器发送简单的命令、调整操作参数、在另一个软件系统上执行操作，以及在全公司范围内执行操作改进程序。</span><span class="sxs-lookup"><span data-stu-id="bca9e-115">Actions may range from sending a simple command to a machine, to tweaking operational parameters, to performing an action on another software system, to implementing company-wide operational improvement programs.</span></span>

<span data-ttu-id="bca9e-116">下图显示了在工厂机器和最终结果之间发生的一系列操作，这是通过仪表板形式表示的“利用率”，其中显示了一个图表和标签“87.5%”。</span><span class="sxs-lookup"><span data-stu-id="bca9e-116">The figure below shows a chain of actions that occur between a factory machine and the end result, which is a dashboard representation of “utilization,” showing a graph and the label “87.5%.”</span></span>

![工厂到仪表板。](assets/extracting-insights-from-iot/factory-to-dashboard.png)

<span data-ttu-id="bca9e-118">为了便于说明，我们将使用一个简单的 KPI 计算：机器利用率。</span><span class="sxs-lookup"><span data-stu-id="bca9e-118">For the purposes of illustration, we will use the calculation of a simple KPI: machine utilization.</span></span> <span data-ttu-id="bca9e-119">机器利用率  是机器实际生产  部件的时间百分比。</span><span class="sxs-lookup"><span data-stu-id="bca9e-119">*Machine utilization* is the percentage of time the machine is actually *producing* parts.</span></span> <span data-ttu-id="bca9e-120">例如，如果一个班次为 8 小时，而机器生产部件的时间为 7 小时，那么该班次的机器利用率是 87.5% (7/8×100)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-120">For example, if there are 8 hours in a shift, and the machine is producing parts for 7 of those hours, then the machine utilization for that shift is 87.5% (7/8 x 100).</span></span>

## <a name="approach"></a><span data-ttu-id="bca9e-121">方法</span><span class="sxs-lookup"><span data-stu-id="bca9e-121">Approach</span></span>

<span data-ttu-id="bca9e-122">IoT 应用程序有三个组件：内容  （或设备），发送用于生成见解  的数据或事件，以便用于生成操作  来帮助改进业务或流程。</span><span class="sxs-lookup"><span data-stu-id="bca9e-122">IoT applications have three components: **things** (or devices), sending data or events that are used to generate **insights**, which are used to generate **actions** to help improve a business or process.</span></span>

<span data-ttu-id="bca9e-123">制造工厂中的设备（内容）在运行时发送各种类型的数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-123">The equipment in a manufacturing plant (things) sends various types of data as it operates.</span></span> <span data-ttu-id="bca9e-124">例如，铣床发送进给率和温度数据；这用于评估机器是否正在运行（即见解），进而用来优化工厂（即操作）。</span><span class="sxs-lookup"><span data-stu-id="bca9e-124">An example is a milling machine sending feed rate and temperature data; this is used to evaluate whether the machine is running or not—an insight—which is used to optimize the plant—an action.</span></span> <span data-ttu-id="bca9e-125">我们将通过这些步骤来提取数据，在仪表板中对其进行可视化，提取新见解，并采取进一步操作。</span><span class="sxs-lookup"><span data-stu-id="bca9e-125">We will go through the steps to extract the data, visualize it in a dashboard, extract new insights, and take further actions.</span></span>
<span data-ttu-id="bca9e-126">![内容到见解再到操作。](assets/extracting-insights-from-iot/things-insights-actions.png)</span><span class="sxs-lookup"><span data-stu-id="bca9e-126">![Things to Insights to Actions.](assets/extracting-insights-from-iot/things-insights-actions.png)</span></span>

<span data-ttu-id="bca9e-127">Microsoft 已经为 IoT 应用程序发布了一个高级参考体系结构，介绍了各种子系统以及这些子系统的推荐方法。</span><span class="sxs-lookup"><span data-stu-id="bca9e-127">Microsoft has published a high level reference architecture for IoT applications that walks through the various subsystems and the recommended approaches for those subsystems.</span></span>
<span data-ttu-id="bca9e-128">IoT 应用程序由以下子系统组成：</span><span class="sxs-lookup"><span data-stu-id="bca9e-128">An IoT application consists of the following subsystems:</span></span>

1. <span data-ttu-id="bca9e-129">设备或本地边缘网关，是一种可以安全地将消息源（设备）注册到云中的特定类型的设备。</span><span class="sxs-lookup"><span data-stu-id="bca9e-129">Devices, or on-premises edge gateways, which are a specific kind of device that can securely register message sources (devices) with the cloud.</span></span> <span data-ttu-id="bca9e-130">边缘网关还可以将消息从本机协议转换为另一种格式（如 JSON）。</span><span class="sxs-lookup"><span data-stu-id="bca9e-130">The edge gateway may also transform messages from a native protocol to another format (such as JSON).</span></span>
2. <span data-ttu-id="bca9e-131">云网关服务或中心（如 [Azure IoT 中心](/azure/iot-hub/?WT.mc_id=iotinsightssoln-docs-ercenk)或 [Azure 事件中心](/azure/event-hubs/event-hubs-about?WT.mc_id=iotinsightssoln-docs-ercenk)），用于安全地引入数据并提供设备管理功能。</span><span class="sxs-lookup"><span data-stu-id="bca9e-131">A cloud gateway service, or hub (such as [Azure IoT Hub](/azure/iot-hub/?WT.mc_id=iotinsightssoln-docs-ercenk) or [Azure Event Hubs](/azure/event-hubs/event-hubs-about?WT.mc_id=iotinsightssoln-docs-ercenk)), to securely ingest data and provide device management capabilities.</span></span> 
3. <span data-ttu-id="bca9e-132">使用流数据的流处理器。</span><span class="sxs-lookup"><span data-stu-id="bca9e-132">Stream processors that consume streaming data.</span></span> <span data-ttu-id="bca9e-133">处理器还可以与业务流程集成，并将数据放入存储中。</span><span class="sxs-lookup"><span data-stu-id="bca9e-133">The processors may also integrate with business processes and place the data into storage.</span></span>
4. <span data-ttu-id="bca9e-134">一个仪表板形式的用户界面，用于可视化 IoT 数据和加速设备管理。</span><span class="sxs-lookup"><span data-stu-id="bca9e-134">A user interface, in the form of a dashboard, to visualize IoT data and facilitate device management.</span></span>

![解决方案的体系结构。](assets/extracting-insights-from-iot/architecture.png)

<span data-ttu-id="bca9e-136">在本文中，我们将重点讨论提取见解的过程。</span><span class="sxs-lookup"><span data-stu-id="bca9e-136">In this article, we focus on the process of extracting insights.</span></span> <span data-ttu-id="bca9e-137">下面是主要步骤：</span><span class="sxs-lookup"><span data-stu-id="bca9e-137">These are the major steps:</span></span>

1. <span data-ttu-id="bca9e-138">访问数据，并将其处理为数据流。</span><span class="sxs-lookup"><span data-stu-id="bca9e-138">Access the data and process it into a data stream.</span></span>
2. <span data-ttu-id="bca9e-139">处理并存储数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-139">Process and store the data.</span></span>
3. <span data-ttu-id="bca9e-140">可视化或呈现数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-140">Visualize or present the data.</span></span> 

<span data-ttu-id="bca9e-141">下图显示了从数据源到转换、引入、处理和存储、表示形式，最后到操作的数据流。</span><span class="sxs-lookup"><span data-stu-id="bca9e-141">The figure below is a diagram that shows the flow of data, from data source, to convert, to ingestion, to process and store, to presentation, and finally action.</span></span>

![数据流：从源到引入到呈现再到操作。](assets/extracting-insights-from-iot/data-flow.png)

## <a name="converting-the-data-to-a-stream"></a><span data-ttu-id="bca9e-143">将数据转换为流</span><span class="sxs-lookup"><span data-stu-id="bca9e-143">Converting the data to a stream</span></span>

<span data-ttu-id="bca9e-144">IoT 数据是时间序列数据：来自“内容”的值在一段时间内可能更有意义。</span><span class="sxs-lookup"><span data-stu-id="bca9e-144">IoT data is time-series data: values from “things” that can be more meaningful over a time span.</span></span> <span data-ttu-id="bca9e-145">工厂车间上的设备会在随时间的运转过程中发生事件。</span><span class="sxs-lookup"><span data-stu-id="bca9e-145">Equipment on a plant floor operates through time, and events occur during that time.</span></span> <span data-ttu-id="bca9e-146">如果工厂车间上的数据没有发送到数据引入服务，例如 [Azure IoT 中心](/azure/iot-hub/?WT.mc_id=iotinsightssoln-docs-ercenk)，我们必须从其存储中定期轮询数据（例如，制造执行系统 (MES) 或 HTTP 终结点），并将数据发送到引入服务。</span><span class="sxs-lookup"><span data-stu-id="bca9e-146">If the data on the plant floor is not sent to a data ingestion service, such as [Azure IoT Hub](/azure/iot-hub/?WT.mc_id=iotinsightssoln-docs-ercenk), we must poll for the data periodically from its store—for  example, a Manufacturing Execution System (MES), or an HTTP endpoint), and send the data to an ingestion service.</span></span>  
<span data-ttu-id="bca9e-147">要将数据转换为流，我们通常：</span><span class="sxs-lookup"><span data-stu-id="bca9e-147">To convert data to a stream, we usually:</span></span>

1. <span data-ttu-id="bca9e-148">访问数据源。</span><span class="sxs-lookup"><span data-stu-id="bca9e-148">Access the data source.</span></span>
2. <span data-ttu-id="bca9e-149">转换和扩充数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-149">Transform and enrich the data.</span></span>
3. <span data-ttu-id="bca9e-150">将数据发布到可以引入流数据的终结点。</span><span class="sxs-lookup"><span data-stu-id="bca9e-150">Post the data to an endpoint that can ingest streaming data.</span></span>

<span data-ttu-id="bca9e-151">这里我们对数据源的访问不做详细介绍，因为访问取决于数据驻留的位置，而且变化太多。</span><span class="sxs-lookup"><span data-stu-id="bca9e-151">We don’t cover the access to the data source in detail here, since access depends on where the data resides,  and the variations are too numerous.</span></span>

## <a name="transforming-and-enriching-the-data"></a><span data-ttu-id="bca9e-152">转换和扩充数据</span><span class="sxs-lookup"><span data-stu-id="bca9e-152">Transforming and enriching the data</span></span>

<span data-ttu-id="bca9e-153">原始数据通常必须经过转换操作才能标准化，并为引入做好准备。</span><span class="sxs-lookup"><span data-stu-id="bca9e-153">Raw data must usually undergo transformation operations to standardize it and prepare it for ingestion.</span></span>  <span data-ttu-id="bca9e-154">具体转换将根据使用的分析类型而异。</span><span class="sxs-lookup"><span data-stu-id="bca9e-154">The specific transformations will vary depending on the type of analytics used.</span></span>  <span data-ttu-id="bca9e-155">数据转换的一些常见示例是时间序列数据，在这些数据中可能缺少度量值并需要输入，或者需要对不同机器之间的时间跨度进行合理化。</span><span class="sxs-lookup"><span data-stu-id="bca9e-155">Some common examples of data transformations are time-series data where measurements may be missing and need to be inputted, or where the time scales across different machines needs to be rationalized.</span></span>  <span data-ttu-id="bca9e-156">我们希望数据记录具有时间戳（如果源包含它的话）并采用名称-值对的形式。</span><span class="sxs-lookup"><span data-stu-id="bca9e-156">We would like to have data records that are timestamped (if the source contains it) and in name-value pairs.</span></span> <span data-ttu-id="bca9e-157">通常，数据采用层次结构格式，并且必须转换为平面结构。</span><span class="sxs-lookup"><span data-stu-id="bca9e-157">Commonly, the data comes in a hierarchical format, and must be transformed into a flat structure.</span></span>

<span data-ttu-id="bca9e-158">下图显示了一个具有交错配置文件的分层数据结构，转换为标准化的列和行格式（块）。</span><span class="sxs-lookup"><span data-stu-id="bca9e-158">The figure below shows a hierarchical data structure with a jagged profile, converted to a standardized column and row format (a block).</span></span>

![数据形状从层次结构到平面不一。](assets/extracting-insights-from-iot/hierarchy-to-flat.png)

<span data-ttu-id="bca9e-160">通常情况下，数据无法从 Internet 上获取。</span><span class="sxs-lookup"><span data-stu-id="bca9e-160">Usually, the data is not accessible from the internet.</span></span> <span data-ttu-id="bca9e-161">一个常见的模式是使用边缘网关将数据从工厂车间推送到引入点。</span><span class="sxs-lookup"><span data-stu-id="bca9e-161">A common pattern is to use an edge gateway to push data from the plant floor to the ingestion point.</span></span> <span data-ttu-id="bca9e-162">[Azure IoT Edge](/azure/iot-edge?WT.mc_id=iotinsightssoln-docs-ercenk) 是基于 IoT 中心构建的服务。</span><span class="sxs-lookup"><span data-stu-id="bca9e-162">[Azure IoT Edge](/azure/iot-edge?WT.mc_id=iotinsightssoln-docs-ercenk) is a service that builds on top of IoT Hub.</span></span> <span data-ttu-id="bca9e-163">IoT Edge 设备可以充当网关覆盖三种[模式](/azure/iot-edge/iot-edge-as-gateway?WT.mc_id=iotinsightssoln-docs-ercenk)：透明网关、协议转换和标识转换。</span><span class="sxs-lookup"><span data-stu-id="bca9e-163">An IoT Edge device can act as a gateway to cover three [patterns](/azure/iot-edge/iot-edge-as-gateway?WT.mc_id=iotinsightssoln-docs-ercenk): transparent gateway, protocol translation, and identity translation.</span></span>

<span data-ttu-id="bca9e-164">如果数据可以在外部使用，并且可以从 Internet 访问，可以使用几个 Azure 服务来访问、转换和扩充数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-164">If the data is available externally and is accessible from internet, several Azure services can be used to access, transform, and enrich the data.</span></span> <span data-ttu-id="bca9e-165">这些选项包括：</span><span class="sxs-lookup"><span data-stu-id="bca9e-165">Among those options are:</span></span>

- <span data-ttu-id="bca9e-166">部署在各种 Azure 计算服务中的自定义代码，例如[应用服务](/azure/app-service/?WT.mc_id=iotinsightssoln-docs-ercenk)、[Azure Kubernetes 服务](/azure/aks/?WT.mc_id=iotinsightssoln-docs-ercenk) (AKS)、[容器实例](/azure/container-instances/?WT.mc_id=iotinsightssoln-docs-ercenk)或 [Service Fabric](/azure/service-fabric/service-fabric-overview?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-166">Custom code deployed in various Azure compute services, such as [App Service](/azure/app-service/?WT.mc_id=iotinsightssoln-docs-ercenk),  [Azure Kubernetes Service](/azure/aks/?WT.mc_id=iotinsightssoln-docs-ercenk) (AKS), [Container Instances](/azure/container-instances/?WT.mc_id=iotinsightssoln-docs-ercenk), or [Service Fabric](/azure/service-fabric/service-fabric-overview?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span>
- [<span data-ttu-id="bca9e-167">Azure 逻辑应用</span><span class="sxs-lookup"><span data-stu-id="bca9e-167">Azure Logic Apps</span></span>](/azure/logic-apps/?WT.mc_id=iotinsightssoln-docs-ercenk)
- [<span data-ttu-id="bca9e-168">Azure 数据工厂中的管道和活动</span><span class="sxs-lookup"><span data-stu-id="bca9e-168">Pipelines and activities in Azure Data Factory</span></span>](/azure/data-factory/copy-activity-overview/?WT.mc_id=iotinsightssoln-docs-ercenk)
- [<span data-ttu-id="bca9e-169">Azure Functions</span><span class="sxs-lookup"><span data-stu-id="bca9e-169">Azure Functions</span></span>](/azure/azure-functions/functions-overview)
- [<span data-ttu-id="bca9e-170">BizTalk 服务</span><span class="sxs-lookup"><span data-stu-id="bca9e-170">BizTalk Services</span></span>](https://azure.microsoft.com/services/biztalk-services/)

<span data-ttu-id="bca9e-171">上述每个服务都有其自己的优势和成本，这要取决于场景。</span><span class="sxs-lookup"><span data-stu-id="bca9e-171">Each of the services above have their own benefits and costs, depending on the scenario.</span></span> <span data-ttu-id="bca9e-172">例如，逻辑应用提供[转换 XML 文档](/azure/logic-apps/logic-apps-enterprise-integration-transform?WT.mc_id=iotinsightssoln-docs-ercenk)的方法。</span><span class="sxs-lookup"><span data-stu-id="bca9e-172">For example, Logic Apps provide a means for [transforming XML documents](/azure/logic-apps/logic-apps-enterprise-integration-transform?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span> <span data-ttu-id="bca9e-173">然而，数据可能是一个过于复杂的 XML 文档，因此，开发一个大型 XSLT 脚本来转换数据可能并不可行。</span><span class="sxs-lookup"><span data-stu-id="bca9e-173">However, the data can be an overly complex XML document, so it may not be practical to develop a large XSLT script to transform the data.</span></span> <span data-ttu-id="bca9e-174">在这种情况下，可以使用来自不同 Azure 服务的多个微服务来开发混合解决方案。</span><span class="sxs-lookup"><span data-stu-id="bca9e-174">In this case, one might develop a hybrid solution using multiple microservices from different Azure services.</span></span> <span data-ttu-id="bca9e-175">例如，在 Azure 逻辑应用中实现的微服务可以轮询 HTTP 终结点，临时存储原始结果，并通知另一个微服务。</span><span class="sxs-lookup"><span data-stu-id="bca9e-175">For example, a microservice, implemented in Azure Logic Apps, can poll an HTTP endpoint, store the raw result temporarily, and notify another microservice.</span></span> <span data-ttu-id="bca9e-176">用于转换消息的另一个微服务可以是托管在 [Azure Functions 主机](https://github.com/Azure/azure-functions-host)上的自定义代码。</span><span class="sxs-lookup"><span data-stu-id="bca9e-176">The other microservice—which transforms the message—can be custom code hosted on [Azure Functions Host](https://github.com/Azure/azure-functions-host).</span></span>  

![Https 对数据进行轮询并由 Functions 负责处理。](assets/extracting-insights-from-iot/poll-logic-process.png)

<span data-ttu-id="bca9e-178">或者，可以选择由 Azure 数据工厂编排的工作流，其中有一系列活动执行转换。</span><span class="sxs-lookup"><span data-stu-id="bca9e-178">Alternatively, you may opt for a workflow orchestrated by Azure Data Factory where a sequence of activities performs the transformations.</span></span> <span data-ttu-id="bca9e-179">有关可用活动类型的详细信息，请参阅 [Azure 数据工厂中的管道和活动](/azure/data-factory/concepts-pipelines-activities)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-179">For more details on the type of activities available, see [Pipelines and activities in Azure Data Factory](/azure/data-factory/concepts-pipelines-activities).</span></span>
<span data-ttu-id="bca9e-180">消息可以在接收时加盖时间戳，也可以包含一个时间戳，以便我们重新构造几个度量值的时间序列。</span><span class="sxs-lookup"><span data-stu-id="bca9e-180">The messages can be timestamped at reception, or they may contain a timestamp to let us reconstruct the time series of several values measured.</span></span> <span data-ttu-id="bca9e-181">因此，可以忽略的引入延迟和高吞吐量是保证信息完整性和最终响应适时性的基础。</span><span class="sxs-lookup"><span data-stu-id="bca9e-181">Hence, negligible ingestion latency and high throughput are fundamental to guarantee the integrity of information and timeliness of eventual responses.</span></span> <span data-ttu-id="bca9e-182">为了减少延迟，我们将时间戳规范化为尽可能接近工厂。</span><span class="sxs-lookup"><span data-stu-id="bca9e-182">To minimize the latency, we normalize the time stamps as close as possible to the plant.</span></span>

## <a name="ingesting-the-data-stream"></a><span data-ttu-id="bca9e-183">引入数据流</span><span class="sxs-lookup"><span data-stu-id="bca9e-183">Ingesting the data stream</span></span>

<span data-ttu-id="bca9e-184">为了将数据作为一个流进行分析，我们可以基于时间窗口对数据进行查询，以识别模式和关系。</span><span class="sxs-lookup"><span data-stu-id="bca9e-184">To analyze the data as a stream, we can do queries on the data based on time windows to identify patterns and relationships.</span></span> <span data-ttu-id="bca9e-185">Azure 平台上有各种各样的服务，可以高吞吐量地引入数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-185">There are various services on the Azure platform that can ingest data at high throughput.</span></span>
<span data-ttu-id="bca9e-186">以下服务的选择取决于项目需要，例如设备管理、协议支持、可伸缩性、团队对编程模型的偏好等。例如，团队可能因为他们的经验而倾向于使用 Kafka，或者需要一个 Kafka 代理来解决这个问题。</span><span class="sxs-lookup"><span data-stu-id="bca9e-186">Choosing between the services below depends on the needs of the project, such as device management, protocol support, scalability, team’s preference of programming model etc. For example, team may have a preference to use Kafka because of their experience, or the need to have a Kafka broker for the solution.</span></span> <span data-ttu-id="bca9e-187">或者，对于另一种情况，项目可能需要数据引入系统来利用 [IoT 中心设备预配服务的 TPM 密钥证明](/azure/iot-dps/?WT.mc_id=iotinsightssoln-docs-ercenk)，以确保设备可以访问引入点。</span><span class="sxs-lookup"><span data-stu-id="bca9e-187">Or, for another case, the project may need the data ingestion system to take advantage of [IoT Hub Device Provisioning Service’s TPM Key Attestation](/azure/iot-dps/?WT.mc_id=iotinsightssoln-docs-ercenk) to secure the access of the devices to the ingestion point.</span></span>

- <span data-ttu-id="bca9e-188">[Azure IoT 中心](/azure/iot-hub/?WT.mc_id=iotinsightssoln-docs-ercenk)是 IoT 应用程序和设备之间的双向通信中心。</span><span class="sxs-lookup"><span data-stu-id="bca9e-188">[Azure IoT Hub](/azure/iot-hub/?WT.mc_id=iotinsightssoln-docs-ercenk) is a bi-directional communication hub between IoT applications and the devices.</span></span> <span data-ttu-id="bca9e-189">它是一项可扩展服务，通过提供安全通信、消息路由、与其他 Azure 服务的集成以及控制和配置设备的管理功能，来支持功能齐全的 IoT 解决方案。</span><span class="sxs-lookup"><span data-stu-id="bca9e-189">It is a scalable service that enables full-featured IoT solutions by providing secure communications, message routing, integration with other Azure services, and management features to control and configure the devices.</span></span>

- <span data-ttu-id="bca9e-190">[Azure 事件中心](/azure/event-hubs/event-hubs-about?WT.mc_id=iotinsightssoln-docs-ercenk)是一个用于以极高吞吐率从并发源收集遥测数据的大规模仅限引入服务。</span><span class="sxs-lookup"><span data-stu-id="bca9e-190">[Azure Event Hubs](/azure/event-hubs/event-hubs-about?WT.mc_id=iotinsightssoln-docs-ercenk) is a high-scale ingestion-only service for collecting telemetry data from concurrent sources at exceedingly high throughput rates.</span></span>
- <span data-ttu-id="bca9e-191">[Apache Kafka on HDInsight](/azure/hdinsight/kafka/apache-kafka-introduction?WT.mc_id=iotinsightssoln-docs-ercenk) 是一个托管 [Apache Kafka](https://kafka.apache.org/) 的托管服务。</span><span class="sxs-lookup"><span data-stu-id="bca9e-191">[Apache Kafka on HDInsight](/azure/hdinsight/kafka/apache-kafka-introduction?WT.mc_id=iotinsightssoln-docs-ercenk) is a managed service that hosts [Apache Kafka](https://kafka.apache.org/).</span></span> <span data-ttu-id="bca9e-192">Apache Kafka 是开源分布式流式处理平台，还提供消息代理功能。</span><span class="sxs-lookup"><span data-stu-id="bca9e-192">Apache Kafka is an open-source distributed streaming platform that also provides message broker functionality.</span></span> <span data-ttu-id="bca9e-193">托管服务对 Kafka 正常运行时间提供 99.9% 的服务级别协议 (SLA)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-193">The hosted service has a Service Level Agreement (SLA) of 99.9% on Kafka uptime.</span></span>

## <a name="processing-and-storing-the-data"></a><span data-ttu-id="bca9e-194">处理和存储数据</span><span class="sxs-lookup"><span data-stu-id="bca9e-194">Processing and storing the data</span></span>

<span data-ttu-id="bca9e-195">IoT 应用程序带来了挑战，因为它们是事件驱动型系统，也需要保留历史数据并基于这些数据运行。</span><span class="sxs-lookup"><span data-stu-id="bca9e-195">The IoT applications introduce challenges, as they are event-driven systems, that also need to keep and operate on historical data.</span></span> <span data-ttu-id="bca9e-196">引入数据是一种追加类型的数据，可能会变大。</span><span class="sxs-lookup"><span data-stu-id="bca9e-196">The incoming data is an append type of data and can potentially grow large.</span></span> <span data-ttu-id="bca9e-197">需要将数据保留较长时间，主要原因如下：存档、批处理分析和构建机器学习 (ML) 模型。</span><span class="sxs-lookup"><span data-stu-id="bca9e-197">There is a need to keep data for longer periods, primarily for these reasons: archive, batch analytics, and to build machine learning (ML) models.</span></span> <span data-ttu-id="bca9e-198">另一方面，事件流对于近实时分析以检测异常、识别滚动时间窗口中的模式或触发警报（如果值超过或低于阈值）至关重要。</span><span class="sxs-lookup"><span data-stu-id="bca9e-198">On the other hand, the event stream is crucial for analyzing in near real-time to detect anomalies, recognize patterns over rolling time windows, or triggering alerts, if values go over or below a threshold.</span></span>
<span data-ttu-id="bca9e-199">Microsoft Azure IoT 参考体系结构为使用 Lambda 体系结构的 IoT 解决方案中的设备到云消息和事件提供了建议的数据流。</span><span class="sxs-lookup"><span data-stu-id="bca9e-199">Microsoft’s Azure IoT Reference Architecture presents a recommended data flow for device to cloud messages and events in an IoT solution using Lambda architecture.</span></span> <span data-ttu-id="bca9e-200">Lambda 体系结构支持对接近实时的流数据和存档数据进行分析，这使得它成为处理传入数据的最佳选择。</span><span class="sxs-lookup"><span data-stu-id="bca9e-200">The Lambda architecture enables the analysis of both near real-time, streaming data, as well as archived data, which makes it the best option for processing of the incoming data.</span></span>

## <a name="lambda-architecture"></a><span data-ttu-id="bca9e-201">Lambda 架构</span><span class="sxs-lookup"><span data-stu-id="bca9e-201">Lambda architecture</span></span>

<span data-ttu-id="bca9e-202">Lambda 体系结构通过创建两个数据流路径来解决此问题。</span><span class="sxs-lookup"><span data-stu-id="bca9e-202">The Lambda architecture addresses this problem by creating two paths for data flow.</span></span> <span data-ttu-id="bca9e-203">所有进入系统的数据都经过这两个路径：</span><span class="sxs-lookup"><span data-stu-id="bca9e-203">All data coming into the system goes through these two paths:</span></span>

- <span data-ttu-id="bca9e-204">批处理层（冷路径）以原始形式存储所有传入数据，并对数据进行批处理。</span><span class="sxs-lookup"><span data-stu-id="bca9e-204">A batch layer (cold path) stores all the incoming data in its raw form and performs batch processing on the data.</span></span> <span data-ttu-id="bca9e-205">该处理的结果作为批处理视图存储。</span><span class="sxs-lookup"><span data-stu-id="bca9e-205">The result of this processing is stored as a batch view.</span></span> <span data-ttu-id="bca9e-206">它是一个执行复杂分析的缓慢处理管道，例如，合并来自多个源和较长时间的数据（数小时、数天或更长时间），并生成新的信息，如报告、机器学习模型等。</span><span class="sxs-lookup"><span data-stu-id="bca9e-206">It is a slow processing pipeline executing complex analysis, for example combining data from multiple sources and over a longer period (hours, days, or longer), and generating new information such as reports, machine learning models, etcetera.</span></span>
- <span data-ttu-id="bca9e-207">速度层（暖路径）可实时分析数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-207">A speed layer (warm path) analyzes data in real time.</span></span> <span data-ttu-id="bca9e-208">设计此层是为了降低延迟，但代价是准确性也会降低。</span><span class="sxs-lookup"><span data-stu-id="bca9e-208">This layer is designed for low latency, at the expense of accuracy.</span></span> <span data-ttu-id="bca9e-209">它是一个更快的处理管道，可以对传入消息进行存档和显示，并分析这些记录，以生成短期关键信息和警报等操作。</span><span class="sxs-lookup"><span data-stu-id="bca9e-209">It is a faster processing pipeline that archives and displays incoming messages, and analyzes these records generating short term critical information and actions such as alarms.</span></span>
- <span data-ttu-id="bca9e-210">批处理层将结果馈送到“服务层”，以便对查询做出响应。</span><span class="sxs-lookup"><span data-stu-id="bca9e-210">The batch layer feeds into a “serving layer,” which responds to queries.</span></span> <span data-ttu-id="bca9e-211">批处理层编制批处理视图的索引，以便提高查询效率。</span><span class="sxs-lookup"><span data-stu-id="bca9e-211">The batch layer indexes the batch view for efficient querying.</span></span> <span data-ttu-id="bca9e-212">速度层会根据最新数据使用增量更新来更新服务层。</span><span class="sxs-lookup"><span data-stu-id="bca9e-212">The speed layer updates the serving layer with incremental updates based on the most recent data.</span></span>

<span data-ttu-id="bca9e-213">下图显示了表示转换阶段的五个块。</span><span class="sxs-lookup"><span data-stu-id="bca9e-213">The following image shows five blocks that represent stages of transformation.</span></span> <span data-ttu-id="bca9e-214">第一个块是数据流，它以并行方式向速度层和批处理层馈送。</span><span class="sxs-lookup"><span data-stu-id="bca9e-214">The first block is the data stream, which feeds both the speed layer and batch layer in parallel.</span></span> <span data-ttu-id="bca9e-215">这两个层均向所服务的层馈送，速度层和所服务的层均向分析客户端馈送。</span><span class="sxs-lookup"><span data-stu-id="bca9e-215">Both layers feed the serving layer, The speed layer and the serving layer both feed the analytics client.</span></span>
<span data-ttu-id="bca9e-216">![Lambda 体系结构。](assets/extracting-insights-from-iot/lambda-schematic.png)</span><span class="sxs-lookup"><span data-stu-id="bca9e-216">![Lambda architecture.](assets/extracting-insights-from-iot/lambda-schematic.png)</span></span>

 <span data-ttu-id="bca9e-217">Azure 平台提供各种服务，可用于实现体系结构。</span><span class="sxs-lookup"><span data-stu-id="bca9e-217">Azure platform provides various services that can be used for implementing the architecture.</span></span> <span data-ttu-id="bca9e-218">下图显示了如何映射这些服务来实现它。</span><span class="sxs-lookup"><span data-stu-id="bca9e-218">The following diagram shows how those services can be mapped to implement it.</span></span> <span data-ttu-id="bca9e-219">图中显示了转换的五个阶段，每个阶段都包含相关的 Azure 技术。</span><span class="sxs-lookup"><span data-stu-id="bca9e-219">The figure shows the five stages of transformation, with each stage containing relevant Azure technologies.</span></span> <span data-ttu-id="bca9e-220">颜色较深的框表示执行这些任务的多个选项的可用性。</span><span class="sxs-lookup"><span data-stu-id="bca9e-220">The darker colored boxes represent the availability of multiple options to perform those tasks.</span></span>

![Lambda 体系结构。](assets/extracting-insights-from-iot/lambda-architecture-all.png)

<span data-ttu-id="bca9e-222">速度层上的数据引入服务选项在前一节“引入数据流”中进行了介绍。</span><span class="sxs-lookup"><span data-stu-id="bca9e-222">The options for the data ingestion service on the speed layer are covered in the previous section, “Ingesting the data stream.”</span></span>

<span data-ttu-id="bca9e-223">[Apache Kafka on HDInsight](/azure/hdinsight/kafka/apache-kafka-introduction?WT.mc_id=iotinsightssoln-docs-ercenk) 可以是一个服务选项，用于实现数据引入服务和流处理的数据流。</span><span class="sxs-lookup"><span data-stu-id="bca9e-223">[Apache Kafka on HDInsight](/azure/hdinsight/kafka/apache-kafka-introduction?WT.mc_id=iotinsightssoln-docs-ercenk) can be a service option to implement the data stream both for the data ingestion service and the stream processing.</span></span>

<span data-ttu-id="bca9e-224">如果你正在为数据引入服务使用事件中心，请使用 [Azure 流分析](/azure/stream-analytics?WT.mc_id=iotinsightssoln-docs-ercenk) (ASA)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-224">Use [Azure Stream Analytics](/azure/stream-analytics?WT.mc_id=iotinsightssoln-docs-ercenk) (ASA) if you are using Event Hubs for the data ingestion service.</span></span> <span data-ttu-id="bca9e-225">Azure 流分析是一个事件处理引擎，用于检查从设备流式传输的大量数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-225">Azure Stream Analytics is an event-processing engine that allows you to examine high volumes of data streaming from devices.</span></span> <span data-ttu-id="bca9e-226">传入数据可能来自设备、传感器、网站、社交媒体源、应用程序等。</span><span class="sxs-lookup"><span data-stu-id="bca9e-226">Incoming data can originate from devices, sensors, web sites, social media feeds, applications, and more.</span></span> <span data-ttu-id="bca9e-227">它还支持从数据流提取信息，以及确定模式和关系。</span><span class="sxs-lookup"><span data-stu-id="bca9e-227">It also supports extracting information from data streams, identifying patterns, and relationships.</span></span>

<span data-ttu-id="bca9e-228">流分析查询从流数据源开始，可以使用引入到 Azure 事件中心、Azure IoT 中心的数据，也可以使用从 Azure Blob 存储之类的数据存储引入的数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-228">Stream Analytics queries start with a source of streaming data that is ingested into Azure Event Hub, Azure IoT Hub or from a data store like Azure Blob Storage.</span></span> <span data-ttu-id="bca9e-229">若要检查流，请创建一个流分析作业，以便指定可流式传输数据的输入源。</span><span class="sxs-lookup"><span data-stu-id="bca9e-229">To examine a stream, create a Stream Analytics job that specifies the input source that streams data.</span></span> <span data-ttu-id="bca9e-230">该作业还指定了转换查询，用于定义如何查找数据、模式或关系。</span><span class="sxs-lookup"><span data-stu-id="bca9e-230">The job also specifies a transformation query that defines how to look for data, patterns, or relationships.</span></span> <span data-ttu-id="bca9e-231">转换查询利用类似 SQL 的查询语言对某个时段的流数据进行筛选、排序、聚合和联接操作。</span><span class="sxs-lookup"><span data-stu-id="bca9e-231">The transformation query leverages a SQL-like query language that is used to filter, sort, aggregate, and join streaming data over a period of time.</span></span>

## <a name="warm-path"></a><span data-ttu-id="bca9e-232">暖路径</span><span class="sxs-lookup"><span data-stu-id="bca9e-232">Warm Path</span></span>

<span data-ttu-id="bca9e-233">本文档的示例场景是机器利用率 KPI（在本指南开头进行了介绍）。</span><span class="sxs-lookup"><span data-stu-id="bca9e-233">The example scenario for this document is a machine utilization KPI (introduced at the beginning of the guide).</span></span> <span data-ttu-id="bca9e-234">我们可以选择对数据进行简单的解释，并假定如果机器正在发送数据，那么它正在被使用。</span><span class="sxs-lookup"><span data-stu-id="bca9e-234">We could opt for a naive interpretation of the data and assume that if the machine is sending data then it is being utilized.</span></span> <span data-ttu-id="bca9e-235">然而，机器可能在发送数据的同时并没有真正生成任何内容（例如，它可能处于空闲或维护状态）。</span><span class="sxs-lookup"><span data-stu-id="bca9e-235">However, the machine could be sending data while not really producing anything (for example, it could be idle, or being maintained).</span></span> <span data-ttu-id="bca9e-236">这是当试图从物联网数据中提取见解时一个很常见的难题：你正在查找的数据在你获取的数据中不可用。</span><span class="sxs-lookup"><span data-stu-id="bca9e-236">This highlights a very common challenge when trying to extract insight out of IoT data: the data you are looking for is not available in the data you are getting.</span></span> <span data-ttu-id="bca9e-237">因此，在本示例中，我们没有获得清楚而明确地告诉我们机器是否处于生产状态的数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-237">So, in our example, we are not getting data clearly and unequivocally telling us whether or not the machine is producing.</span></span>  <span data-ttu-id="bca9e-238">所以，我们需要通过将获取的数据与其他数据源相结合，并应用规则来确定机器是否处于生产状态，以此来推断利用率。</span><span class="sxs-lookup"><span data-stu-id="bca9e-238">Therefore, we need to infer utilization by combining the data we are getting with other sources of data, and applying rules to determine of whether or not the machine is producing.</span></span> <span data-ttu-id="bca9e-239">此外，这些规则可能因公司而异，因为它们可能对“生产”有不同的解释。</span><span class="sxs-lookup"><span data-stu-id="bca9e-239">In addition, these rules may change from company to company since they may have different interpretations of what “producing” is.</span></span> <span data-ttu-id="bca9e-240">暖路径旨在当数据流经系统时进行分析。</span><span class="sxs-lookup"><span data-stu-id="bca9e-240">The warm path is all about analyzing as the data flows through the system.</span></span> <span data-ttu-id="bca9e-241">我们以近实时的方式处理此流，将它保存到暖存储中，并将其推送到分析客户端。</span><span class="sxs-lookup"><span data-stu-id="bca9e-241">We process this stream in near-real time, save it to the warm storage, and push it to the analytics clients.</span></span>

<span data-ttu-id="bca9e-242">Azure 事件中心是一个大数据流式处理平台和事件引入服务，每秒能够接收和处理数百万个事件。</span><span class="sxs-lookup"><span data-stu-id="bca9e-242">Azure Event Hubs is a big data streaming platform and event ingestion service, capable of receiving and processing millions of events per second.</span></span> <span data-ttu-id="bca9e-243">事件中心可以处理和存储分布式软件和设备生成的事件、数据或遥测。</span><span class="sxs-lookup"><span data-stu-id="bca9e-243">Event Hubs can process and store events, data, or telemetry produced by distributed software and devices.</span></span> <span data-ttu-id="bca9e-244">可以使用任何实时分析提供程序或批处理/存储适配器转换和存储发送到数据中心的数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-244">Data sent to an event hub can be transformed and stored using any real-time analytics provider or batching/storage adapters.</span></span> <span data-ttu-id="bca9e-245">事件中心为数据流暖路径的第一步提供了完美匹配。</span><span class="sxs-lookup"><span data-stu-id="bca9e-245">Event Hubs makes the perfect match for the first step in the warm path for the data flow.</span></span>

<span data-ttu-id="bca9e-246">下图显示了速度层阶段。</span><span class="sxs-lookup"><span data-stu-id="bca9e-246">The figure below shows the speed layer stage.</span></span> <span data-ttu-id="bca9e-247">它包含事件中心、流分析实例和暖存储的数据存储。</span><span class="sxs-lookup"><span data-stu-id="bca9e-247">It consists of an event hub, a Stream Analytics instance, and a data store for warm storage.</span></span>

![Lambda 体系结构：突出显示速度层。](assets/extracting-insights-from-iot/lambda-2.png)
  
<span data-ttu-id="bca9e-249">Azure 平台提供了多种在事件中心处理事件的选项，但我们推荐使用流分析。</span><span class="sxs-lookup"><span data-stu-id="bca9e-249">The Azure platform provides many options for processing the events on an Event Hub, however, we recommend Stream Analytics.</span></span> <span data-ttu-id="bca9e-250">流分析还可以将数据推送到 Power BI 服务以可视化流数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-250">Stream Analytics can also push data to the Power BI service to visualize streamed data.</span></span>

<span data-ttu-id="bca9e-251">流分析可以大规模执行复杂分析，例如，翻转/滑动/跳跃窗口、流聚合和外部数据源联接。</span><span class="sxs-lookup"><span data-stu-id="bca9e-251">Stream Analytics can execute complex analysis at scale, for example, tumbling/sliding/hopping windows, stream aggregations, and external data source joins.</span></span> <span data-ttu-id="bca9e-252">对于更复杂的处理，可以通过层叠事件中心、流分析作业和 Azure Fucntions 等多个实例来扩展性能，如下图所示。</span><span class="sxs-lookup"><span data-stu-id="bca9e-252">For even more complex processing, performance can be extended by cascading multiple instances of Event Hubs, Stream Analytics jobs, and Azure functions, as shown in the following figure.</span></span>

![事件中心到分析再到 Power BI。](assets/extracting-insights-from-iot/event-hubs-to-power-bi.png)
  
<span data-ttu-id="bca9e-254">可以在 Azure 平台上使用各种服务实现暖存储，比如 Azure SQL 数据库。</span><span class="sxs-lookup"><span data-stu-id="bca9e-254">Warm storage can be implemented with various services on the Azure platform, such as Azure SQL Database.</span></span> <span data-ttu-id="bca9e-255">我们建议使用 [Azure Cosmos DB](/azure/cosmos-db/introduction?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-255">We recommend [Azure Cosmos DB](/azure/cosmos-db/introduction?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span> <span data-ttu-id="bca9e-256">它是 Microsoft 推出的全球分布式多模型数据库。</span><span class="sxs-lookup"><span data-stu-id="bca9e-256">It is Microsoft's globally distributed, multi-model database.</span></span> <span data-ttu-id="bca9e-257">对于那些可以从灵活的、与架构无关的、自动索引和丰富的查询接口中获益的数据集来说，这是最佳选择。</span><span class="sxs-lookup"><span data-stu-id="bca9e-257">It is best for datasets that can benefit from flexible, schema-agnostic, automatic indexing, and rich query interfaces.</span></span> <span data-ttu-id="bca9e-258">Cosmos DB 允许多区域、读/写，除了自动故障转移之外，还支持手动故障转移。</span><span class="sxs-lookup"><span data-stu-id="bca9e-258">Cosmos DB allows multi-region, read/write, and supports manual failover in addition to automatic failover.</span></span> <span data-ttu-id="bca9e-259">此外，Cosmos DB 允许用户在他们的数据上设置生存时间 (TTL)，从而使旧数据自动过期。</span><span class="sxs-lookup"><span data-stu-id="bca9e-259">In addition, Cosmos DB allows the user to set a time-to-live (TTL) on their data, which makes expiring old data automatic.</span></span> <span data-ttu-id="bca9e-260">建议使用该功能来控制记录在数据库中的保存时间，从而控制数据库大小。</span><span class="sxs-lookup"><span data-stu-id="bca9e-260">We recommend using the feature to control the time the records stay in the database, thus controlling the database size.</span></span>

<span data-ttu-id="bca9e-261">Cosmos DB 的定价基于使用的存储和预配的[请求单位](/azure/cosmos-db/request-units)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-261">Pricing for Cosmos DB is based on storage used and [request units](/azure/cosmos-db/request-units) provisioned.</span></span> <span data-ttu-id="bca9e-262">Cosmos DB 最适合于不需要涉及大型数据集聚合查询的场景，因为这些查询需要的请求单位比基本查询（如设备的最后一个事件）更多。</span><span class="sxs-lookup"><span data-stu-id="bca9e-262">Cosmos DB is best for scenarios that do not require queries involving aggregation over large sets of data, as those queries require more request units than a basic query such as the last event for a device.</span></span>  

<span data-ttu-id="bca9e-263">[Microsoft Power BI](/power-bi/power-bi-overview?WT.mc_id=iotinsightssoln-docs-ercenk) 是一个软件服务、应用程序和连接器集合，它们共同协作，将不相关的数据源转换为一致的、直观逼真的交互式见解。</span><span class="sxs-lookup"><span data-stu-id="bca9e-263">[Microsoft Power BI](/power-bi/power-bi-overview?WT.mc_id=iotinsightssoln-docs-ercenk) is a collection of software services, apps, and connectors that work together to turn your unrelated sources of data into coherent, visually immersive, and interactive insights.</span></span> <span data-ttu-id="bca9e-264">Power BI 帮助你及时了解重要信息。</span><span class="sxs-lookup"><span data-stu-id="bca9e-264">Power BI helps you stay up to date with the information that matters to you.</span></span> <span data-ttu-id="bca9e-265">可以利用 [Power BI 中的实时流](/power-bi/service-real-time-streaming?WT.mc_id=iotinsightssoln-docs-ercenk)将数据推送到服务。</span><span class="sxs-lookup"><span data-stu-id="bca9e-265">You can utilize the [real-time streaming in Power BI](/power-bi/service-real-time-streaming?WT.mc_id=iotinsightssoln-docs-ercenk) to push data to the service.</span></span> <span data-ttu-id="bca9e-266">此实时流可以作为 Power BI 仪表板上各种视觉对象的实时流数据源。</span><span class="sxs-lookup"><span data-stu-id="bca9e-266">This real time stream can act as a real time streaming data source for various visuals on the Power BI dashboard.</span></span>

## <a name="cold-path"></a><span data-ttu-id="bca9e-267">冷路径</span><span class="sxs-lookup"><span data-stu-id="bca9e-267">Cold Path</span></span>

<span data-ttu-id="bca9e-268">在暖路径中，流处理会随着时间的推移发现模式。</span><span class="sxs-lookup"><span data-stu-id="bca9e-268">The warm path is where the stream processing occurs to discover patterns over time.</span></span> <span data-ttu-id="bca9e-269">然而，我们还想计算在过去一段时间内的利用率，使用不同的数据透视表和聚合，如机器、生产线、工厂、生产部件等等。</span><span class="sxs-lookup"><span data-stu-id="bca9e-269">However we also would like to calculate the utilization over a period of time in the past, with different pivots, and aggregations, such as machine, line, plant, produced part etcetera.</span></span> <span data-ttu-id="bca9e-270">我们希望将这些结果与暖路径结果合并，向用户提供一个统一的视图。</span><span class="sxs-lookup"><span data-stu-id="bca9e-270">We  want to merge those results with the warm path results to present a unified view to the user.</span></span> <span data-ttu-id="bca9e-271">冷路径包括批处理层和所服务的层。</span><span class="sxs-lookup"><span data-stu-id="bca9e-271">The cold path includes the batch layer and the serving layers.</span></span> <span data-ttu-id="bca9e-272">该组合可提供系统的长期视图。</span><span class="sxs-lookup"><span data-stu-id="bca9e-272">The combination provides a long-term view of the system.</span></span>

<span data-ttu-id="bca9e-273">冷路径包含解决方案的长期数据存储。</span><span class="sxs-lookup"><span data-stu-id="bca9e-273">The cold path contains the long-term data store for the solution.</span></span> <span data-ttu-id="bca9e-274">它还包含批处理层，这会创建预先计算的聚合视图，以提供长时间的快速查询响应。</span><span class="sxs-lookup"><span data-stu-id="bca9e-274">It also contains the batch layer, which creates pre-calculated aggregate views to provide fast query responses over long periods of time.</span></span> <span data-ttu-id="bca9e-275">Azure 平台上可用于这一层的技术选项非常多样化。</span><span class="sxs-lookup"><span data-stu-id="bca9e-275">The technology options available for this layer on Azure platform is quite diverse.</span></span>

![Lambda 体系结构：突出显示批处理层。](assets/extracting-insights-from-iot/lambda-3.png)
  
<span data-ttu-id="bca9e-277">[Azure 时序见解](/azure/time-series-insights/?WT.mc_id=iotinsightssoln-docs-ercenk) (TSI) 是针对时间序列数据的分析、存储和可视化服务。</span><span class="sxs-lookup"><span data-stu-id="bca9e-277">[Azure Time Series Insights](/azure/time-series-insights/?WT.mc_id=iotinsightssoln-docs-ercenk) (TSI) is an analytics, storage and visualization service for time series data.</span></span> <span data-ttu-id="bca9e-278">它提供了类似于 SQL 的筛选和聚合，从而缓解对用户定义函数的需求。</span><span class="sxs-lookup"><span data-stu-id="bca9e-278">It provides SQL-like filtering and aggregation, alleviating the need for user-defined functions.</span></span> <span data-ttu-id="bca9e-279">TSI 可以接收来自事件中心、IoT 中心或 Azure Blob 存储的数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-279">TSI can receive data from Event Hubs, IoT Hub or Azure Blob storage.</span></span> <span data-ttu-id="bca9e-280">TSI 中的所有数据都存储在内存和 SSD 中，这确保了数据可以随时进行交互式分析。</span><span class="sxs-lookup"><span data-stu-id="bca9e-280">All data in TSI is stored in-memory and in SSDs, which ensures that the data is always ready for interactive analytics.</span></span> <span data-ttu-id="bca9e-281">例如，一个超过数千万个事件的典型聚合在发出指令后数毫秒内返回。</span><span class="sxs-lookup"><span data-stu-id="bca9e-281">For example, a typical aggregation over tens of millions of events returns on the order of milliseconds.</span></span> <span data-ttu-id="bca9e-282">它还提供可视化效果，例如不同时间序列的叠加、仪表板比较、可访问的表格视图和热度地图。</span><span class="sxs-lookup"><span data-stu-id="bca9e-282">It also provides visualizations such as overlays of different time series, dashboard comparisons, accessible tabular views, and heat maps.</span></span> <span data-ttu-id="bca9e-283">TSI 的主要功能包括：</span><span class="sxs-lookup"><span data-stu-id="bca9e-283">Key features of TSI include:</span></span>

- <span data-ttu-id="bca9e-284">为不需要立即报告数据的解决方案提供内置的可视化服务。</span><span class="sxs-lookup"><span data-stu-id="bca9e-284">Built-in visualization services for solutions that do not need to report on data immediately.</span></span> <span data-ttu-id="bca9e-285">TSI 在查询数据记录时大约有 30-60 秒的延迟。</span><span class="sxs-lookup"><span data-stu-id="bca9e-285">TSI has an approximate latency for querying data records of 30-60 seconds.</span></span> 
- <span data-ttu-id="bca9e-286">查询大型数据集的功能。</span><span class="sxs-lookup"><span data-stu-id="bca9e-286">The ability to query large sets of data.</span></span>
- <span data-ttu-id="bca9e-287">任意数量的用户都可以进行无限数量的查询，而无需额外付费。</span><span class="sxs-lookup"><span data-stu-id="bca9e-287">Any number of users can conduct an unlimited number of queries for no extra cost.</span></span>

<span data-ttu-id="bca9e-288">TSI 的最大保留期为 400 天，最大存储空间上限为 3 TB。</span><span class="sxs-lookup"><span data-stu-id="bca9e-288">TSI has a maximum retention of 400 days and a maximum storage limit of 3 TB.</span></span> <span data-ttu-id="bca9e-289">如果需要更长的保留时间或更大的容量，请使用冷存储数据库（将数据交换到 TSI 以根据需要进行查询）。</span><span class="sxs-lookup"><span data-stu-id="bca9e-289">If you require a longer retention span, or more capacity, use a cold storage database (swapping data into TSI for querying as needed).</span></span>

<span data-ttu-id="bca9e-290">随着时间的推移，IoT 应用程序的冷存储将越来越大。</span><span class="sxs-lookup"><span data-stu-id="bca9e-290">Cold storage for an IoT application is certain to grow large over time.</span></span> <span data-ttu-id="bca9e-291">这是长期存储数据并在用于分析的批处理视图中聚合的位置。</span><span class="sxs-lookup"><span data-stu-id="bca9e-291">This is where data is stored for the long term and aggregated at the batch views for analytics.</span></span> <span data-ttu-id="bca9e-292">ML 模型数据也存储在此处。</span><span class="sxs-lookup"><span data-stu-id="bca9e-292">Data for ML models is also stored here.</span></span> <span data-ttu-id="bca9e-293">建议使用 [Azure 存储](/azure/storage/?WT.mc_id=iotinsightssoln-docs-ercenk)进行冷存储。</span><span class="sxs-lookup"><span data-stu-id="bca9e-293">We recommend [Azure Storage](/azure/storage/?WT.mc_id=iotinsightssoln-docs-ercenk) for the cold storage.</span></span> <span data-ttu-id="bca9e-294">它是一项 Microsoft 托管服务，能够提供在可用性、安全性、持久性、可伸缩性和冗余性方面都很高的云存储。</span><span class="sxs-lookup"><span data-stu-id="bca9e-294">It is a Microsoft-managed service providing cloud storage that is highly available, secure, durable, scalable, and redundant.</span></span> <span data-ttu-id="bca9e-295">Azure 存储包括 Azure Blob（对象）、Azure Data Lake Storage Gen2、Azure 文件、Azure 队列和 Azure 表。</span><span class="sxs-lookup"><span data-stu-id="bca9e-295">Azure Storage includes Azure Blobs (objects), Azure Data Lake Storage Gen2, Azure Files, Azure Queues, and Azure Tables.</span></span> <span data-ttu-id="bca9e-296">冷存储可以是 Blob、Data Lake Storage Gen2 或 Azure 表，也可以是这些产品的组合。</span><span class="sxs-lookup"><span data-stu-id="bca9e-296">The cold storage can be either Blobs, Data Lake Storage Gen2, or Azure Tables., or a combination of those.</span></span>

<span data-ttu-id="bca9e-297">[Azure 表存储](/azure/cosmos-db/table-storage-overview?WT.mc_id=iotinsightssoln-docs-ercenk)是一项用于在云中存储结构化 NoSQL 数据的服务，通过无架构设计提供键/属性存储。</span><span class="sxs-lookup"><span data-stu-id="bca9e-297">[Azure Table storage](/azure/cosmos-db/table-storage-overview?WT.mc_id=iotinsightssoln-docs-ercenk) is a service that stores structured NoSQL data in the cloud, providing a key/attribute store with a schemaless design.</span></span> <span data-ttu-id="bca9e-298">因为表存储无架构，因此，可以很容易地随着应用程序需求的发展使数据适应存储。</span><span class="sxs-lookup"><span data-stu-id="bca9e-298">Because Table Storage is schemaless, it is easy to adapt your data as the needs of your application evolve.</span></span> <span data-ttu-id="bca9e-299">对于许多类型的应用程序来说，访问表存储数据速度快且经济高效，在数据量相似的情况下，其成本通常比传统 SQL 要低。</span><span class="sxs-lookup"><span data-stu-id="bca9e-299">Access to Table Storage data is fast and cost-effective for many types of applications and is typically lower in cost than traditional SQL for similar volumes of data.</span></span> <span data-ttu-id="bca9e-300">我们将一个表用于示例，一个表用于从数据流接收的事件。</span><span class="sxs-lookup"><span data-stu-id="bca9e-300">We use one table for samples, and one table for events that are received from data streams.</span></span> <span data-ttu-id="bca9e-301">分区键设计是一个特别重要的概念；两个表都使用事件或示例上的时间戳的小时数。</span><span class="sxs-lookup"><span data-stu-id="bca9e-301">The design of the partition key is an especially important concept; both tables use the hour of the timestamp on the event or the sample.</span></span> <span data-ttu-id="bca9e-302">有关详细信息，请参阅 [Understanding the Table Service Data Model](/rest/api/storageservices/Understanding-the-Table-Service-Data-Model?WT.mc_id=iotinsightssoln-docs-ercenk)（了解表服务数据模型）。</span><span class="sxs-lookup"><span data-stu-id="bca9e-302">For more information, see [Understanding the Table Service Data Model](/rest/api/storageservices/Understanding-the-Table-Service-Data-Model?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span>

<span data-ttu-id="bca9e-303">要存储大量非结构化数据，比如 JSON 或包含 IoT 应用程序接收到的未处理数据的 XML 文档，最佳选择是 [Blob 存储](/azure/storage/blobs/storage-blobs-introduction?WT.mc_id=iotinsightssoln-docs-ercenk)、[Azure 文件](/azure/storage/files/storage-files-introduction?WT.mc_id=iotinsightssoln-docs-ercenk)或 [Azure Data Lake Storage Gen2](/azure/storage/data-lake-storage/introduction?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-303">To store massive amounts of unstructured data, such as JSON, or XML documents containing the unprocessed data received by the IoT application, [Blob storage](/azure/storage/blobs/storage-blobs-introduction?WT.mc_id=iotinsightssoln-docs-ercenk), [Azure Files](/azure/storage/files/storage-files-introduction?WT.mc_id=iotinsightssoln-docs-ercenk), or [Azure Data Lake Storage Gen2](/azure/storage/data-lake-storage/introduction?WT.mc_id=iotinsightssoln-docs-ercenk) are the best options.</span></span>

<span data-ttu-id="bca9e-304">可以通过 HTTP 或 HTTPS 从世界上的任何位置安全地访问 Azure Blob 存储。</span><span class="sxs-lookup"><span data-stu-id="bca9e-304">Azure Blob storage can be accessed from anywhere in the world via HTTP or HTTPS securely.</span></span> <span data-ttu-id="bca9e-305">必须使用服务所用的[授权机制](/azure/storage/common/storage-auth?toc=%2fazure%2fstorage%2fblobs%2ftoc.json?WT.mc_id=iotinsightssoln-docs-ercenk)之一对 Blob 存储访问进行授权。</span><span class="sxs-lookup"><span data-stu-id="bca9e-305">Access to the blob storage must be authorized using one of the [authorization mechanisms](/azure/storage/common/storage-auth?toc=%2fazure%2fstorage%2fblobs%2ftoc.json?WT.mc_id=iotinsightssoln-docs-ercenk) used by the service.</span></span> <span data-ttu-id="bca9e-306">该服务提供多个复制[选项](/azure/storage/common/storage-redundancy?toc=%2fazure%2fstorage%2fblobs%2ftoc.json?WT.mc_id=iotinsightssoln-docs-ercenk)：本地冗余、区域冗余、异地冗余和读取访问异地冗余。</span><span class="sxs-lookup"><span data-stu-id="bca9e-306">The service provides multiple replication [options](/azure/storage/common/storage-redundancy?toc=%2fazure%2fstorage%2fblobs%2ftoc.json?WT.mc_id=iotinsightssoln-docs-ercenk): locally redundant, zone-redundant, geo-redundant and read access geo-redundant.</span></span> <span data-ttu-id="bca9e-307">此外，还有三个[访问层](/azure/storage/blobs/storage-blob-storage-tiers?WT.mc_id=iotinsightssoln-docs-ercenk)，可以提供最具成本效益的解决方案。</span><span class="sxs-lookup"><span data-stu-id="bca9e-307">There are also three [access tiers](/azure/storage/blobs/storage-blob-storage-tiers?WT.mc_id=iotinsightssoln-docs-ercenk) that allows the most cost-effective solutions.</span></span>

<span data-ttu-id="bca9e-308">数据进入冷存储后，需要在 Lambda 体系结构所服务的层上创建批处理视图。</span><span class="sxs-lookup"><span data-stu-id="bca9e-308">Once the data is in cold storage, batch views on the serving layer of the Lambda architecture need to be created.</span></span> <span data-ttu-id="bca9e-309">[Azure 数据工厂](/azure/data-factory/introduction?WT.mc_id=iotinsightssoln-docs-ercenk)是在所服务的层上创建批处理视图的理想解决方案。</span><span class="sxs-lookup"><span data-stu-id="bca9e-309">[Azure Data Factory](/azure/data-factory/introduction?WT.mc_id=iotinsightssoln-docs-ercenk) is a great solution for creating the batch views on the serving layer.</span></span> <span data-ttu-id="bca9e-310">它是基于云的托管数据集成服务，用于在云中创建数据驱动型工作流，以便协调和自动完成数据移动和数据转换。</span><span class="sxs-lookup"><span data-stu-id="bca9e-310">It is a cloud-based managed data integration service that allows you to create data-driven workflows in the cloud for orchestrating and automating data movement and data transformation.</span></span> <span data-ttu-id="bca9e-311">可以使用 Azure 数据工厂创建和计划[数据驱动型工作流](/azure/data-factory/concepts-pipelines-activities?WT.mc_id=iotinsightssoln-docs-ercenk)（称为“管道”），以便从不同的数据存储引入数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-311">Using Azure Data Factory, you can create and schedule [data-driven workflows](/azure/data-factory/concepts-pipelines-activities?WT.mc_id=iotinsightssoln-docs-ercenk) (called pipelines) that can ingest data from disparate data stores.</span></span> <span data-ttu-id="bca9e-312">它可以使用服务（例如 [Azure HDInsight Hadoop](/azure/hdinsight/?WT.mc_id=iotinsightssoln-docs-ercenk)、[Spark](/azure/hdinsight/?WT.mc_id=iotinsightssoln-docs-ercenk) 和 [Azure Databricks](/azure/azure-databricks/?WT.mc_id=iotinsightssoln-docs-ercenk)）处理和转换数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-312">It can process and transform the data by using services such as [Azure HDInsight Hadoop](/azure/hdinsight/?WT.mc_id=iotinsightssoln-docs-ercenk), [Spark](/azure/hdinsight/?WT.mc_id=iotinsightssoln-docs-ercenk), and [Azure Databricks](/azure/azure-databricks/?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span> <span data-ttu-id="bca9e-313">这允许你构建机器学习模型并与分析客户端一起使用。</span><span class="sxs-lookup"><span data-stu-id="bca9e-313">This allows you to build machine learning models and consume them with the analytics clients.</span></span>

<span data-ttu-id="bca9e-314">例如，如下图所示，数据工厂管道将从主数据存储中读取数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-314">For example, as shown in the following figure, Data Factory pipelines read data from the master data store.</span></span> <span data-ttu-id="bca9e-315">一个管道汇总和聚合数据，以填充 Azure 数据仓库实例。</span><span class="sxs-lookup"><span data-stu-id="bca9e-315">One pipeline summarizes and aggregates the data to populate an instance of Azure Data Warehouse.</span></span> <span data-ttu-id="bca9e-316">数据工厂管道还包含用于构建 ML 模型的 [Azure Databricks 笔记本活动](/azure/data-factory/transform-data-using-databricks-notebook?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-316">The Data Factory pipeline also and contains [Azure Databricks notebook activities](/azure/data-factory/transform-data-using-databricks-notebook?WT.mc_id=iotinsightssoln-docs-ercenk) that are used to build ML models.</span></span>

![Lambda 体系结构：突出显示批处理层。](assets/extracting-insights-from-iot/master-data-to-ml-analytics.png)
  
<span data-ttu-id="bca9e-318">[Azure SQL 数据库](/azure/sql-database/?WT.mc_id=iotinsightssoln-docs-ercenk)或 [Azure SQL 数据仓库](/azure/sql-data-warehouse/sql-data-warehouse-overview-what-is?WT.mc_id=iotinsightssoln-docs-ercenk)是用于托管批处理视图的最佳选项。</span><span class="sxs-lookup"><span data-stu-id="bca9e-318">[Azure SQL Database](/azure/sql-database/?WT.mc_id=iotinsightssoln-docs-ercenk) or [Azure SQL Data Warehouse](/azure/sql-data-warehouse/sql-data-warehouse-overview-what-is?WT.mc_id=iotinsightssoln-docs-ercenk) are the best options for hosting the batch views.</span></span> <span data-ttu-id="bca9e-319">这些服务可以在主数据上提供预计算和聚合视图。</span><span class="sxs-lookup"><span data-stu-id="bca9e-319">These services can serve pre-calculated and aggregated views on the master data.</span></span> 

<span data-ttu-id="bca9e-320">Azure SQL 数据库 (SQL DB) 是基于最新版 Microsoft SQL Server 数据库引擎的关系数据库即服务。</span><span class="sxs-lookup"><span data-stu-id="bca9e-320">Azure SQL Database (SQL DB) is a relational database-as-a-service based on the latest version of Microsoft SQL Server Database Engine.</span></span> <span data-ttu-id="bca9e-321">SQL DB 是一个可靠、安全的高性能数据库，可以使用它来构建数据驱动型应用程序和网站。</span><span class="sxs-lookup"><span data-stu-id="bca9e-321">SQL DB is a high-performance, reliable, and secure database you can use to build data-driven applications and websites.</span></span> <span data-ttu-id="bca9e-322">作为一项 Azure 服务，不需要管理它的基础结构。</span><span class="sxs-lookup"><span data-stu-id="bca9e-322">As an Azure service,  there is no need to manage its infrastructure.</span></span> <span data-ttu-id="bca9e-323">随着数据量的增加，解决方案可以开始使用数据聚合和存储技术来加速查询。</span><span class="sxs-lookup"><span data-stu-id="bca9e-323">As the data volume increases, the solution can start using techniques to aggregate and store data for speeding up the queries.</span></span> <span data-ttu-id="bca9e-324">预先计算的聚合是众所周知的方法，尤其是对于仅追加的数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-324">Pre-calculating aggregations is a well-known technique, especially for append-only data.</span></span> <span data-ttu-id="bca9e-325">它对成本管理也很有用。</span><span class="sxs-lookup"><span data-stu-id="bca9e-325">It is also useful for managing costs.</span></span>

<span data-ttu-id="bca9e-326">Azure SQL 数据仓库提供了在某些场景中有用的许多附加功能。</span><span class="sxs-lookup"><span data-stu-id="bca9e-326">Azure SQL Data Warehouse provides many additional features that can be useful in some scenarios.</span></span> <span data-ttu-id="bca9e-327">它是基于云的企业数据仓库，可利用大规模并行处理对 PB 级数据快速运行复杂的查询。</span><span class="sxs-lookup"><span data-stu-id="bca9e-327">It is a cloud-based enterprise data warehouse that leverages massively parallel processing  to quickly run complex queries across petabytes of data.</span></span> <span data-ttu-id="bca9e-328">如果需要保留 PB 级数据，并且希望查询能够快速运行，则建议使用 SQL 数据仓库。</span><span class="sxs-lookup"><span data-stu-id="bca9e-328">If you need to keep petabytes of data, and want to have queries running fast, we recommend SQL Data Warehouse.</span></span>

## <a name="visualizing-the-data"></a><span data-ttu-id="bca9e-329">可视化数据</span><span class="sxs-lookup"><span data-stu-id="bca9e-329">Visualizing the data</span></span>

<span data-ttu-id="bca9e-330">在这一层上，我们希望合并两个数据管道（暖路径和冷路径），以呈现数据的内聚视图。</span><span class="sxs-lookup"><span data-stu-id="bca9e-330">At this layer, we want to merge the two data pipelines (warm and cold paths) to present a cohesive view of the data.</span></span> <span data-ttu-id="bca9e-331">在此示例中，我们使用多个指标来推断机器在暖路径和冷路径上的利用率。</span><span class="sxs-lookup"><span data-stu-id="bca9e-331">In this example, we used multiple metrics to deduce the utilization of the machine on both warm and cold paths.</span></span> <span data-ttu-id="bca9e-332">在分析阶段，我们提供合并来自这些路径的数据的可视化效果。</span><span class="sxs-lookup"><span data-stu-id="bca9e-332">In the analytics stage, we provide visualizations that combine the data from those paths.</span></span>

![Lambda 体系结构：突出显示分析客户端层。](assets/extracting-insights-from-iot/lambda-4.png)

<span data-ttu-id="bca9e-334">[Microsoft Power BI](/power-bi/?WT.mc_id=iotinsightssoln-docs-ercenk) 和 [Azure 时序见解](/azure/time-series-insights/?WT.mc_id=iotinsightssoln-docs-ercenk)提供现成的数据可视化效果。</span><span class="sxs-lookup"><span data-stu-id="bca9e-334">[Microsoft Power BI](/power-bi/?WT.mc_id=iotinsightssoln-docs-ercenk) and [Azure Time Series Insights](/azure/time-series-insights/?WT.mc_id=iotinsightssoln-docs-ercenk) provide data visualizations out-of-the-box.</span></span> <span data-ttu-id="bca9e-335">Power BI 是一种业务分析解决方案，可以用来可视化数据，并在组织内共享见解，或将它们嵌入到应用或网站中。</span><span class="sxs-lookup"><span data-stu-id="bca9e-335">Power BI is business analytics solution that lets you visualize your data and share insights across your organization, or embed them in your app or website.</span></span> <span data-ttu-id="bca9e-336">[Power BI Desktop](https://powerbi.microsoft.com/desktop/?WT.mc_id=iotinsightssoln-docs-ercenk) 是功能强大的免费工具，用于建模报表及其基础数据源。</span><span class="sxs-lookup"><span data-stu-id="bca9e-336">[Power BI Desktop](https://powerbi.microsoft.com/desktop/?WT.mc_id=iotinsightssoln-docs-ercenk) is a free and powerful tool for modelling reports and their underlying data sources.</span></span>  <span data-ttu-id="bca9e-337">嵌入 Power BI 可视化效果的应用程序使用由桌面工具编写并在 Power BI 服务上托管的报告。</span><span class="sxs-lookup"><span data-stu-id="bca9e-337">The applications embedding Power BI visualizations use the reports authored by the desktop tool and hosted on the Power BI Service.</span></span>

<span data-ttu-id="bca9e-338">时序见解有一个数据浏览器，可用来可视化和查询数据以及 REST 查询 API。</span><span class="sxs-lookup"><span data-stu-id="bca9e-338">Time Series Insights has a data explorer to visualize and query data as well as REST query APIs.</span></span> <span data-ttu-id="bca9e-339">此外，它还公开了一个 JavaScript 控件库，允许你将 TSI 支持的图表嵌入到自定义应用程序中。</span><span class="sxs-lookup"><span data-stu-id="bca9e-339">Further, it exposes a JavaScript controls library that lets you embed TSI-powered charts into custom applications.</span></span> <span data-ttu-id="bca9e-340">下面是 TSI 上的一个基本热度地图视图，用于获取接近车间机器利用率的输入数据，只需查看观察到的样本数量即可。</span><span class="sxs-lookup"><span data-stu-id="bca9e-340">The following is a basic heatmap view on the TSI for the incoming data that approximates the utilization of the machines on the shop floor, by simply looking at the number of samples observed.</span></span>

![Lambda 体系结构：突出显示批处理层。](assets/extracting-insights-from-iot/client-screen.png)

<span data-ttu-id="bca9e-342">如果需要一个基于浏览器的用户界面来聚合来自多个源的数据，TSI 和 Power BI 服务都要允许嵌入可视化控件。</span><span class="sxs-lookup"><span data-stu-id="bca9e-342">If you require a browser-based user interface that aggregates data from multiple sources, both TSI and Power BI services allow embedding visualization controls.</span></span> <span data-ttu-id="bca9e-343">两者都提供了 REST API（[Power BI REST API](/rest/api/power-bi/?WT.mc_id=iotinsightssoln-docs-ercenk)、[TSI REST API](/rest/api/time-series-insights/time-series-insights-reference-queryapi?WT.mc_id=iotinsightssoln-docs-ercenk)）和 JavaScript SDK（[Power BI JavaScript SDK](https://github.com/Microsoft/PowerBI-JavaScript?WT.mc_id=iotinsightssoln-docs-ercenk)、[TSI JavaScript SDK](/azure/time-series-insights/tutorial-explore-js-client-lib?WT.mc_id=iotinsightssoln-docs-ercenk)），允许大量的自定义项。</span><span class="sxs-lookup"><span data-stu-id="bca9e-343">Both also provide REST APIs ([Power BI Rest API](/rest/api/power-bi/?WT.mc_id=iotinsightssoln-docs-ercenk), [TSI REST API](/rest/api/time-series-insights/time-series-insights-reference-queryapi?WT.mc_id=iotinsightssoln-docs-ercenk)) and JavaScript SDKs ([Power BI JavaScript SDK](https://github.com/Microsoft/PowerBI-JavaScript?WT.mc_id=iotinsightssoln-docs-ercenk), [TSI JavaScript SDK](/azure/time-series-insights/tutorial-explore-js-client-lib?WT.mc_id=iotinsightssoln-docs-ercenk)) that allows extensive customizations.</span></span>

## <a name="next-steps"></a><span data-ttu-id="bca9e-344">后续步骤</span><span class="sxs-lookup"><span data-stu-id="bca9e-344">Next Steps</span></span>

<span data-ttu-id="bca9e-345">我们介绍了大量的概念，并希望为读者提供一系列起点来了解更多信息，并将技术应用于他们自己的需求。</span><span class="sxs-lookup"><span data-stu-id="bca9e-345">We covered a lot of concepts and would like to give the reader a set of starting points to learn more and apply the techniques to their own requirements.</span></span> <span data-ttu-id="bca9e-346">为此，我们提供了下面一些有用的教程。</span><span class="sxs-lookup"><span data-stu-id="bca9e-346">Here are some tutorials we believe can be useful for this purpose.</span></span>

- <span data-ttu-id="bca9e-347">将数据转换为流</span><span class="sxs-lookup"><span data-stu-id="bca9e-347">Converting the data to a stream</span></span>
  - [<span data-ttu-id="bca9e-348">创建按计划运行的逻辑应用</span><span class="sxs-lookup"><span data-stu-id="bca9e-348">Creating a Logic App running on a schedule</span></span>](/azure/logic-apps/tutorial-build-schedule-recurring-logic-app-workflow?WT.mc_id=iotinsightssoln-docs-ercenk)
  - [<span data-ttu-id="bca9e-349">对逻辑应用执行数据操作的代码示例</span><span class="sxs-lookup"><span data-stu-id="bca9e-349">Code examples for data operations on Logic Apps</span></span>](/azure/logic-apps/logic-apps-data-operations-code-samples?WT.mc_id=iotinsightssoln-docs-ercenk)
  - <span data-ttu-id="bca9e-350">多个位置介绍了有关[在一个容器中运行 Azure Functions](/azure/azure-functions/functions-create-function-linux-custom-image?WT.mc_id=iotinsightssoln-docs-ercenk) 以托管 Azure 函数的信息。</span><span class="sxs-lookup"><span data-stu-id="bca9e-350">[Running Azure Functions in a container](/azure/azure-functions/functions-create-function-linux-custom-image?WT.mc_id=iotinsightssoln-docs-ercenk) to host your Azure Function is covered in multiple places.</span></span> <span data-ttu-id="bca9e-351">使用自定义映像在 Linux 上创建函数，在任何平台上运行函数，在 Azure Functions 运行时运行 Docker 映像</span><span class="sxs-lookup"><span data-stu-id="bca9e-351">Creating a function on Linux using a custom image, running functions on any platform, Docker images for Azure Functions Runtime</span></span>
  - [<span data-ttu-id="bca9e-352">在 Azure Functions 上使用各种绑定</span><span class="sxs-lookup"><span data-stu-id="bca9e-352">Using various bindings on Azure Functions</span></span>](/azure/azure-functions/functions-triggers-bindings?WT.mc_id=iotinsightssoln-docs-ercenk)

- <span data-ttu-id="bca9e-353">热路径</span><span class="sxs-lookup"><span data-stu-id="bca9e-353">Hot path</span></span>
  - <span data-ttu-id="bca9e-354">端到端教程演示了事件中心、Azure 流分析和 Power BI 的使用。</span><span class="sxs-lookup"><span data-stu-id="bca9e-354">End-to-end tutorials demonstrating the use of Event Hubs, Azure Stream Analytics and Power BI.</span></span> <span data-ttu-id="bca9e-355">有关分步说明，请参阅[教程：教程：将发送到 Azure 事件中心的实时事件中的数据异常可视化](/azure/event-hubs/event-hubs-tutorial-visualize-anomalies?WT.mc_id=iotinsightssoln-docs-ercenk)以及[创建一个流分析工作来分析电话呼叫数据](/azure/stream-analytics/stream-analytics-manage-job?WT.mc_id=iotinsightssoln-docs-ercenk)，并在 Power BI 仪表板中将结果可视化。</span><span class="sxs-lookup"><span data-stu-id="bca9e-355">See [Tutorial: Visualize data anomalies](/azure/event-hubs/event-hubs-tutorial-visualize-anomalies?WT.mc_id=iotinsightssoln-docs-ercenk) in real-time events sent to Azure Event Hubs, and [Create a Stream Analytics job to analyze phone call data](/azure/stream-analytics/stream-analytics-manage-job?WT.mc_id=iotinsightssoln-docs-ercenk) and visualize results in a Power BI dashboard.</span></span>
  <span data-ttu-id="bca9e-356">-[在 .NET 中使用 Azure Cosmos DB](/azure/cosmos-db/sql-api-get-started?WT.mc_id=iotinsightssoln-docs-ercenk)</span><span class="sxs-lookup"><span data-stu-id="bca9e-356">-[Using Azure Cosmos DB with .NET](/azure/cosmos-db/sql-api-get-started?WT.mc_id=iotinsightssoln-docs-ercenk)</span></span>
- <span data-ttu-id="bca9e-357">冷路径</span><span class="sxs-lookup"><span data-stu-id="bca9e-357">Cold path</span></span>
  - <span data-ttu-id="bca9e-358">在 Azure 数据工厂中[使用 Spark 活动转换云中的数据](/azure/data-factory/tutorial-transform-data-spark-portal?WT.mc_id=iotinsightssoln-docs-ercenk)</span><span class="sxs-lookup"><span data-stu-id="bca9e-358">[Transforming data in the cloud by using a Spark activity](/azure/data-factory/tutorial-transform-data-spark-portal?WT.mc_id=iotinsightssoln-docs-ercenk) in Azure Data Factory</span></span>
  - [<span data-ttu-id="bca9e-359">教程：创建 Azure 时序见解环境</span><span class="sxs-lookup"><span data-stu-id="bca9e-359">Tutorial: Create an Azure Time Series Insights environment</span></span>](/azure/time-series-insights/tutorial-create-populate-tsi-environment?WT.mc_id=iotinsightssoln-docs-ercenk)
- <span data-ttu-id="bca9e-360">分析客户端</span><span class="sxs-lookup"><span data-stu-id="bca9e-360">Analysis clients</span></span>
  - [<span data-ttu-id="bca9e-361">学习 Power BI</span><span class="sxs-lookup"><span data-stu-id="bca9e-361">Learning Power BI</span></span>](/power-bi/guided-learning/?WT.mc_id=iotinsightssoln-docs-ercenk)
  - [<span data-ttu-id="bca9e-362">创建时序见解 SPA</span><span class="sxs-lookup"><span data-stu-id="bca9e-362">Creating a Time Series Insights SPA</span></span>](/azure/time-series-insights/tutorial-create-tsi-sample-spa?WT.mc_id=iotinsightssoln-docs-ercenk)
  - [<span data-ttu-id="bca9e-363">探索时序见解 JavaScript 客户端库</span><span class="sxs-lookup"><span data-stu-id="bca9e-363">Exploring Time Series Insights Java Script client library</span></span>](/azure/time-series-insights/tutorial-explore-js-client-lib?WT.mc_id=iotinsightssoln-docs-ercenk)
  - <span data-ttu-id="bca9e-364">请参阅 [TSI 演示](https://insights.timeseries.azure.com/demo)和 [Power BI 演示](https://microsoft.github.io/PowerBI-JavaScript/demo/v2-demo/index.html)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-364">See the [TSI demo](https://insights.timeseries.azure.com/demo) and [Power BI demo](https://microsoft.github.io/PowerBI-JavaScript/demo/v2-demo/index.html).</span></span>

## <a name="appendix-pillars-of-software-quality-posq"></a><span data-ttu-id="bca9e-365">附录：软件质量的构成要素 (PoSQ)</span><span class="sxs-lookup"><span data-stu-id="bca9e-365">Appendix: Pillars of software quality (PoSQ)</span></span>

<span data-ttu-id="bca9e-366">一个成功的云应用程序应基于[软件质量的五大构成要素](/azure/architecture/guide/pillars?WT.mc_id=iotinsightssoln-docs-ercenk)而构建：可伸缩性、可用性、复原能力、管理和安全性。</span><span class="sxs-lookup"><span data-stu-id="bca9e-366">A successful cloud application is built on these [pillars of software quality](/azure/architecture/guide/pillars?WT.mc_id=iotinsightssoln-docs-ercenk): Scalability, availability, resiliency, management, and security.</span></span> <span data-ttu-id="bca9e-367">在本节中，我们将根据需要简要介绍每个组件的上述构成要素。</span><span class="sxs-lookup"><span data-stu-id="bca9e-367">In this section, we will briefly cover those pillars for each component as necessary.</span></span> <span data-ttu-id="bca9e-368">我们不会对可用性、复原能力、管理和 DevOps 进行说明，因为它们主要在实现级别上讨论，而我们想要提到的是，Azure 平台提供了通过 API、工具、诊断和日志记录来实现这些功能的广泛方法。</span><span class="sxs-lookup"><span data-stu-id="bca9e-368">We don’t cover availability, resiliency, management and DevOps, since they are mostly addressed at the implementation level, and we want to mention Azure platform provides extensive means for achieving those through APIs, tools, diagnostics and logging.</span></span> <span data-ttu-id="bca9e-369">除了上面提到的构成要素，还将涉及到成本效益。</span><span class="sxs-lookup"><span data-stu-id="bca9e-369">In addition to the mentioned pillars, we will also mention cost efficiency.</span></span>

<span data-ttu-id="bca9e-370">让我们快速查看这些构成要素：</span><span class="sxs-lookup"><span data-stu-id="bca9e-370">Let’s quickly review those pillars:</span></span>

- <span data-ttu-id="bca9e-371">可伸缩性  是指系统处理增加的负载的能力。</span><span class="sxs-lookup"><span data-stu-id="bca9e-371">**Scalability** is the ability of a system to handle increased load.</span></span> <span data-ttu-id="bca9e-372">应用程序可通过两种主要方式进行扩展。</span><span class="sxs-lookup"><span data-stu-id="bca9e-372">There are two main ways that an application can scale.</span></span> <span data-ttu-id="bca9e-373">垂直扩展（纵向扩展）指增加资源的容量，例如通过使用更大的 VM。</span><span class="sxs-lookup"><span data-stu-id="bca9e-373">Vertical scaling (scaling up) means increasing the capacity of a resource, for example by using a larger VM size.</span></span> <span data-ttu-id="bca9e-374">水平扩展（横向扩展）指添加资源的新实例，比如 VM 或数据库副本。</span><span class="sxs-lookup"><span data-stu-id="bca9e-374">Horizontal scaling (scaling out) is adding new instances of a resource, such as VMs or database replicas.</span></span> <span data-ttu-id="bca9e-375">可伸缩性构成要素还包括性能和处理负载的能力。</span><span class="sxs-lookup"><span data-stu-id="bca9e-375">The scalability pillar also includes performance and the ability to handle load.</span></span>
- <span data-ttu-id="bca9e-376">可用性  指系统正常工作时间所占的比例。</span><span class="sxs-lookup"><span data-stu-id="bca9e-376">**Availability** is the proportion of time that the system is functional and working.</span></span> <span data-ttu-id="bca9e-377">通常通过运行时间百分比衡量。</span><span class="sxs-lookup"><span data-stu-id="bca9e-377">It is usually measured as a percentage of uptime.</span></span> <span data-ttu-id="bca9e-378">应用程序错误、基础结构问题和系统负载都会降低可用性。</span><span class="sxs-lookup"><span data-stu-id="bca9e-378">Application errors, infrastructure problems, and system load can all reduce availability.</span></span> <span data-ttu-id="bca9e-379">Microsoft Azure 服务的服务级别协议已发布并在[服务级别协议](https://azure.microsoft.com/support/legal/sla/?WT.mc_id=iotinsightssoln-docs-ercenk)中提供。</span><span class="sxs-lookup"><span data-stu-id="bca9e-379">The service level agreements for Microsoft Azure services are published and available at [Service Level Agreements](https://azure.microsoft.com/support/legal/sla/?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span> <span data-ttu-id="bca9e-380">可用性是系统级别上唯一有意义的指标。</span><span class="sxs-lookup"><span data-stu-id="bca9e-380">Availability is the only meaningful metric at the system level.</span></span> <span data-ttu-id="bca9e-381">单独的组件有助于系统的整体可用性。</span><span class="sxs-lookup"><span data-stu-id="bca9e-381">Separate components contribute to the overall availability of the system.</span></span>
- <span data-ttu-id="bca9e-382">复原能力  是指系统从故障中恢复并继续正常运行的能力。</span><span class="sxs-lookup"><span data-stu-id="bca9e-382">**Resiliency** is the ability of the system to recover from failures and continue to function.</span></span> <span data-ttu-id="bca9e-383">复原能力的目标是在故障发生后将应用程序恢复到可完全正常运行的状态。</span><span class="sxs-lookup"><span data-stu-id="bca9e-383">The goal of resiliency is to return the application to a fully functioning state after a failure occurs.</span></span> <span data-ttu-id="bca9e-384">复原能力与可用性密切相关。</span><span class="sxs-lookup"><span data-stu-id="bca9e-384">Resiliency is closely related to availability.</span></span>
- <span data-ttu-id="bca9e-385">**管理和 DevOps**。</span><span class="sxs-lookup"><span data-stu-id="bca9e-385">**Management and DevOps**.</span></span> <span data-ttu-id="bca9e-386">此构成要素涵盖让应用程序在生产环境中持续运行的操作过程。</span><span class="sxs-lookup"><span data-stu-id="bca9e-386">This pillar covers the operations processes that keep an application running in production.</span></span> <span data-ttu-id="bca9e-387">部署必须可靠且可预测。</span><span class="sxs-lookup"><span data-stu-id="bca9e-387">Deployments must be reliable and predictable.</span></span> <span data-ttu-id="bca9e-388">它们应实现自动化，以减少人为失误的可能性。</span><span class="sxs-lookup"><span data-stu-id="bca9e-388">They should be automated to reduce the chance of human error.</span></span> <span data-ttu-id="bca9e-389">它们应当是一个快速、例行的过程，这样就不会减缓新功能或 bug 修复的发布速度。</span><span class="sxs-lookup"><span data-stu-id="bca9e-389">They should be a fast and routine process, so they do not slow down the release of new features or bug fixes.</span></span> <span data-ttu-id="bca9e-390">如果更新出现问题，你必须能够快速回滚或前滚，这一点也同样重要。</span><span class="sxs-lookup"><span data-stu-id="bca9e-390">Equally important, you must be able to quickly roll back or roll forward if an update has problems.</span></span>
- <span data-ttu-id="bca9e-391">安全性  应该是从设计和实施到部署和操作的整个解决方案生命周期的主要关注点。</span><span class="sxs-lookup"><span data-stu-id="bca9e-391">**Security** should be a major focus point throughout the entire lifecycle of a solution, from design and implementation to deployment and operations.</span></span> <span data-ttu-id="bca9e-392">标识管理、保护基础结构、应用程序安全性、授权、数据主权和加密、审核是需要解决的所有广泛领域。</span><span class="sxs-lookup"><span data-stu-id="bca9e-392">Identity management, protecting your infrastructure, application security, authorization, data sovereignty and encryption, auditing are all broad areas that need to be addressed.</span></span>

## <a name="posq-converting-the-data-to-a-stream"></a><span data-ttu-id="bca9e-393">PoSQ：将数据转换为流</span><span class="sxs-lookup"><span data-stu-id="bca9e-393">PoSQ: Converting the data to a stream</span></span>

<span data-ttu-id="bca9e-394">**可伸缩性**：我们可以从两个角度来考虑可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="bca9e-394">**Scalability**: We can approach the scalability from two perspectives.</span></span> <span data-ttu-id="bca9e-395">首先，从组件的角度来看，其次，从提供源数据的系统的角度来看。</span><span class="sxs-lookup"><span data-stu-id="bca9e-395">First, from the perspective of the component, second, from the perspective of the system that provides the source data.</span></span>

<span data-ttu-id="bca9e-396">每个 Azure 服务都提供了垂直和水平缩放的选项。</span><span class="sxs-lookup"><span data-stu-id="bca9e-396">Each Azure service provides options for vertical and horizontal scaling.</span></span> <span data-ttu-id="bca9e-397">强烈建议在设计解决方案时考虑可伸缩性需求。</span><span class="sxs-lookup"><span data-stu-id="bca9e-397">We strongly recommend considering the scalability requirements while designing the solution.</span></span>

<span data-ttu-id="bca9e-398">对于提供源数据的系统，我们需要小心，不要让系统不堪重负，并且不要通过频繁地查询系统而导致系统遭受拒绝服务 (DoS) 攻击。</span><span class="sxs-lookup"><span data-stu-id="bca9e-398">As for the systems providing the source data, we need to be careful about not to overwhelm the system, and basically causing a denial of service (DoS) attack on the system, by querying it too frequently.</span></span> <span data-ttu-id="bca9e-399">如果正在轮询系统，应记住，调整轮询频率有两个影响：数据粒度（查询频率越高，就越接近实时）以及在远程系统上创建的负载。</span><span class="sxs-lookup"><span data-stu-id="bca9e-399">If you are polling the system, you should keep in mind that adjusting the polling frequency has two effects, the granularity of the data (the more often you query, the closer it gets to real-time) and the load created on the remote system.</span></span>

<span data-ttu-id="bca9e-400">**安全性**：如果通过对称或非对称密钥来访问远程系统，建议将机密保留在 [Azure Key Vault](/azure/key-vault/?WT.mc_id=iotinsightssoln-docs-ercenk) 中。</span><span class="sxs-lookup"><span data-stu-id="bca9e-400">**Security**: If the remote system is accessed by symmetrical or asymmetrical keys, we recommend the secrets to be kept in [Azure Key Vault](/azure/key-vault/?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span>

## <a name="posq-warm-path"></a><span data-ttu-id="bca9e-401">PoSQ：暖路径</span><span class="sxs-lookup"><span data-stu-id="bca9e-401">PoSQ: Warm path</span></span>

<span data-ttu-id="bca9e-402">**可伸缩性**：如果 Azure 事件中心在引入子系统中使用，则主要可伸缩性机制是[吞吐量单位](/azure/event-hubs/event-hubs-features#throughput-units?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-402">**Scalability**: If Azure Event Hubs is the used in the ingestion subsystem, the main scalability mechanism is [throughput units](/azure/event-hubs/event-hubs-features#throughput-units?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span> <span data-ttu-id="bca9e-403">事件中心以静态方式提供设置吞吐量单位的功能，或者通过[自动膨胀功能](/azure/event-hubs/event-hubs-auto-inflate?WT.mc_id=iotinsightssoln-docs-ercenk)进行设置。</span><span class="sxs-lookup"><span data-stu-id="bca9e-403">Event Hubs provide the capability of setting the throughput units statically, or through the [auto-inflate feature](/azure/event-hubs/event-hubs-auto-inflate?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span>

<span data-ttu-id="bca9e-404">流分析中的[流单元](/azure/stream-analytics/stream-analytics-streaming-unit-consumption?WT.mc_id=iotinsightssoln-docs-ercenk) (SU) 表示分配用于执行作业的计算资源。</span><span class="sxs-lookup"><span data-stu-id="bca9e-404">[Streaming Units](/azure/stream-analytics/stream-analytics-streaming-unit-consumption?WT.mc_id=iotinsightssoln-docs-ercenk) (SUs) in Stream Analytics represent the computing resources that are allocated to execute a job.</span></span> <span data-ttu-id="bca9e-405">SU 的数量越多，为作业分配的 CPU 和 内存资源就越多。</span><span class="sxs-lookup"><span data-stu-id="bca9e-405">The higher the number of SUs, the more CPU and memory resources are allocated for your job.</span></span> <span data-ttu-id="bca9e-406">此容量使你能够专注于查询逻辑，并且无需管理及时运行流分析作业所需的硬件。</span><span class="sxs-lookup"><span data-stu-id="bca9e-406">This capacity lets you focus on the query logic and abstracts the need to manage the hardware to run your Stream Analytics job in a timely manner.</span></span> <span data-ttu-id="bca9e-407">除了 SU 之外，通过[正确地并行化查询](/azure/stream-analytics/stream-analytics-scale-jobs?WT.mc_id=iotinsightssoln-docs-ercenk)来高效地使用它们至关重要。</span><span class="sxs-lookup"><span data-stu-id="bca9e-407">In addition to SUs, making efficient use of them through [properly parallelizing the queries](/azure/stream-analytics/stream-analytics-scale-jobs?WT.mc_id=iotinsightssoln-docs-ercenk) is crucial.</span></span>

<span data-ttu-id="bca9e-408">Azure Cosmos DB 实现需预配正确的吞吐量参数和适当的分区设计。</span><span class="sxs-lookup"><span data-stu-id="bca9e-408">Azure Cosmos DB implementations need to be provisioned with the right throughput parameters and proper partitioning design.</span></span> <span data-ttu-id="bca9e-409">预配吞吐量可以在容器或数据库级别进行，并以[请求单位](/azure/cosmos-db/request-units?WT.mc_id=iotinsightssoln-docs-ercenk) (RU) 表示。</span><span class="sxs-lookup"><span data-stu-id="bca9e-409">Provisioning the throughput is available at the container or the data base level, and expressed in [Request Units](/azure/cosmos-db/request-units?WT.mc_id=iotinsightssoln-docs-ercenk) (RUs).</span></span> <span data-ttu-id="bca9e-410">Cosmos DB 提供了用于估算 RU 的工具。</span><span class="sxs-lookup"><span data-stu-id="bca9e-410">Cosmos DB provides a tool for estimating the RUs.</span></span> <span data-ttu-id="bca9e-411">除了预配吞吐量外，[有效地对数据库分区](/azure/cosmos-db/partition-data?WT.mc_id=iotinsightssoln-docs-ercenk)也是关键。</span><span class="sxs-lookup"><span data-stu-id="bca9e-411">In addition to provisioning the throughput, [efficiently partitioning the database](/azure/cosmos-db/partition-data?WT.mc_id=iotinsightssoln-docs-ercenk) is key.</span></span>

<span data-ttu-id="bca9e-412">**安全性**：客户端对 Azure 事件中心的访问是通过用于客户端身份验证的共享访问签名 (SAS) 令牌与事件发布者的组合实现的。</span><span class="sxs-lookup"><span data-stu-id="bca9e-412">**Security**: Access to Azure Event Hubs by clients is through a combination of Shared Access Signature (SAS) tokens and event publishers for client authentication.</span></span> <span data-ttu-id="bca9e-413">后端应用程序的安全性遵循与服务总线主题相同的概念。</span><span class="sxs-lookup"><span data-stu-id="bca9e-413">The security for back-end applications follow the same concepts as the Service Bus topics.</span></span> <span data-ttu-id="bca9e-414">有关事件中心安全模型的详细描述，请参阅[事件中心身份验证和安全模型概述](/azure/event-hubs/event-hubs-authentication-and-security-model-overview?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-414">A thorough description of the Event Hubs security model is in the [Event Hubs authentication and security model overview](/azure/event-hubs/event-hubs-authentication-and-security-model-overview?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span>

<span data-ttu-id="bca9e-415">确保 Cosmos DB 数据库的安全提供了对数据的受控访问权限和静止加密。</span><span class="sxs-lookup"><span data-stu-id="bca9e-415">Securing the Cosmos DB databases provides controlled access to the data, and encryption at rest.</span></span> <span data-ttu-id="bca9e-416">有关详细信息，请参阅 [Azure Cosmos DB 数据库安全性](/azure/cosmos-db/database-security?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-416">For more information, see [Azure Cosmos DB database security](/azure/cosmos-db/database-security?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span>

<span data-ttu-id="bca9e-417">**成本效益**：事件中心的定价取决于 SKU（标准或高级）、接收的数百万事件，以及吞吐量单位。</span><span class="sxs-lookup"><span data-stu-id="bca9e-417">**Cost Efficiency**: The pricing of Event Hubs is a function of the SKU (standard or premium), and the millions of events received, plus throughput units.</span></span> <span data-ttu-id="bca9e-418">通过查看传入消息指示的数据引入速率，可以实现最佳组合。</span><span class="sxs-lookup"><span data-stu-id="bca9e-418">The optimum combination can be achieved by looking at the data ingest rate that is dictated by the incoming messages.</span></span>

<span data-ttu-id="bca9e-419">当使用 Cosmos DB 时，建议通过 RU 利用率观察存储的最优使用。</span><span class="sxs-lookup"><span data-stu-id="bca9e-419">When using Cosmos DB, we recommend observing the most optimum use of the store through the RU utilization.</span></span> <span data-ttu-id="bca9e-420">如上文所述，Cosmos DB 还有一个控制数据保留的功能，建议使用该功能来控制记录在数据库中的保留时间，从而控制数据库大小。</span><span class="sxs-lookup"><span data-stu-id="bca9e-420">Cosmos DB also has a feature for controlling data retention, as we stated earlier, we recommend using the feature to control the time the records stay in the database, thus controlling the database size.</span></span>

## <a name="posq-cold-path"></a><span data-ttu-id="bca9e-421">PoSQ：冷路径</span><span class="sxs-lookup"><span data-stu-id="bca9e-421">PoSQ: Cold path</span></span>

<span data-ttu-id="bca9e-422">**可伸缩性**：Azure 时序见解 (TSI) 根据一个名为“容量”的指标进行缩放，该指标是一个乘数，用于计算入口速率、存储容量以及与 SKU 相关的成本。</span><span class="sxs-lookup"><span data-stu-id="bca9e-422">**Scalability**: Azure Time Series Insights (TSI) is scaled with a metric named as “capacity” which is a multiplier applied to the ingress rate, storage capacity and the cost associated with the SKU.</span></span> 

<span data-ttu-id="bca9e-423">Azure 时序见解拥有多个 SKU，这些 SKU 也会对其垂直缩放产生直接影响。</span><span class="sxs-lookup"><span data-stu-id="bca9e-423">Azure Time Series Insights has multiple SKUs that also have direct effect on its vertical scale.</span></span> <span data-ttu-id="bca9e-424">有关缩放的详细信息，请参阅文档[规划 Azure 时序见解环境](/azure/time-series-insights/time-series-insights-environment-planning?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-424">See the document [Plan your Azure Time Series Insights environment](/azure/time-series-insights/time-series-insights-environment-planning?WT.mc_id=iotinsightssoln-docs-ercenk) for details on scale.</span></span> <span data-ttu-id="bca9e-425">与许多其他 Azure 服务一样，TSI 也会受到限制，以避免“邻近干扰”问题。</span><span class="sxs-lookup"><span data-stu-id="bca9e-425">Like many other Azure services, TSI is also subject to throttling to avoid the “noisy neighbor” problem.</span></span> <span data-ttu-id="bca9e-426">邻近干扰是共享环境 /azure/sql-database/sql-database-service-tiers-vcore?WT.mc_id=iotinsightssoln-docs-ercenk 中的应用程序，它独占资源并导致其他用户缺乏可用资源。</span><span class="sxs-lookup"><span data-stu-id="bca9e-426">A noisy neighbor is an application on a shared environment /azure/sql-database/sql-database-service-tiers-vcore?WT.mc_id=iotinsightssoln-docs-ercenk that monopolizes the resources and starves the other users.</span></span> <span data-ttu-id="bca9e-427">有关管理限制的信息，请参阅 [TSI 文档](/azure/time-series-insights/time-series-insights-environment-mitigate-latency?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-427">Please see the [TSI documentation](/azure/time-series-insights/time-series-insights-environment-mitigate-latency?WT.mc_id=iotinsightssoln-docs-ercenk) for managing the throttling.</span></span> 

<span data-ttu-id="bca9e-428">有关存储帐户的可伸缩性目标，请参阅 [Azure 存储可伸缩性和性能目标](/azure/storage/common/storage-scalability-targets?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-428">Scalability targets of storage accounts are documented in [Azure Storage Scalability and Performance Targets](/azure/storage/common/storage-scalability-targets?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span> <span data-ttu-id="bca9e-429">存储超出单个存储帐户容量的数据的一种常见技术是跨多个存储帐户进行分区。</span><span class="sxs-lookup"><span data-stu-id="bca9e-429">A common technique for storing data beyond the capacity of a single storage account is partitioning across multiple storage accounts.</span></span>

<span data-ttu-id="bca9e-430">根据购买模型（基于 [DTU](/azure/sql-database/sql-database-service-tiers-dtu?WT.mc_id=iotinsightssoln-docs-ercenk) 和基于 vCore），Azure SQL 数据库有许多选项来垂直和水平管理可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="bca9e-430">Azure SQL Database has many options to manage scalability, both vertically and horizontally, depending on the purchasing model ([DTU based](/azure/sql-database/sql-database-service-tiers-dtu?WT.mc_id=iotinsightssoln-docs-ercenk) and vCore based).</span></span> <span data-ttu-id="bca9e-431">建议进一步研究，使用本主题的 [SQL 数据库文档](/azure/sql-database/sql-database-scale-resources?WT.mc_id=iotinsightssoln-docs-ercenk)找到未来解决方案的最佳选择。</span><span class="sxs-lookup"><span data-stu-id="bca9e-431">We recommend further research to find the best option for a future solution using the [SQL Database documentation](/azure/sql-database/sql-database-scale-resources?WT.mc_id=iotinsightssoln-docs-ercenk) on the topic.</span></span>

<span data-ttu-id="bca9e-432">**安全性**：TSI 环境为相互独立的管理访问和数据访问提供[访问策略](/azure/time-series-insights/time-series-insights-data-access?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-432">**Security**: TSI environments provide [access policies](/azure/time-series-insights/time-series-insights-data-access?WT.mc_id=iotinsightssoln-docs-ercenk) for management access and data access independent of each other.</span></span> <span data-ttu-id="bca9e-433">除了已定义的数据源之外，没有其他方法可以直接向 TSI 环境添加数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-433">There is no direct way to add data to a TSI environment other than the defined data sources.</span></span> <span data-ttu-id="bca9e-434">管理访问策略授予的权限与环境配置相关。</span><span class="sxs-lookup"><span data-stu-id="bca9e-434">Management access policies grant permissions related to the configuration of the environment.</span></span> <span data-ttu-id="bca9e-435">数据访问策略授予的权限适用于：发出数据查询、操作环境中的引用数据，以及共享已保存的与环境关联的查询和透视。</span><span class="sxs-lookup"><span data-stu-id="bca9e-435">Data access policies grant permissions to issue data queries, manipulate reference data in the environment, and share saved queries and perspectives associated with the environment.</span></span>

<span data-ttu-id="bca9e-436">Azure 数据工厂服务提供了多种方法来保护数据存储凭据，无论是在其托管存储中，还是在 Azure Key Vault 中。</span><span class="sxs-lookup"><span data-stu-id="bca9e-436">Azure Data Factory service provides multiple methods for securing data store credentials, either in its managed store, or in Azure Key Vault.</span></span> <span data-ttu-id="bca9e-437">传输中的数据加密取决于数据存储传输（例如 HTTPS 或 TLS）。</span><span class="sxs-lookup"><span data-stu-id="bca9e-437">In-transit data encryption depends on the data store’s transport (e.g. HTTPS or TLS).</span></span> <span data-ttu-id="bca9e-438">静态数据加密也依赖于数据存储。</span><span class="sxs-lookup"><span data-stu-id="bca9e-438">At-rest data encryption also depends on the data stores.</span></span> <span data-ttu-id="bca9e-439">有关更多详细信息，请参阅 [Azure 数据工厂中数据移动的安全注意事项](/azure/data-factory/data-movement-security-considerations?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-439">See [Security considerations for data movement in Azure Data Factory](/azure/data-factory/data-movement-security-considerations?WT.mc_id=iotinsightssoln-docs-ercenk) for further details.</span></span>

<span data-ttu-id="bca9e-440">SQL 数据库提供了一组广泛的针对数据访问的安全功能，用于监视、审核和加密静态数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-440">SQL Database provides an extensive set of security features for data access, monitoring and auditing as well as encrypting data at rest.</span></span> <span data-ttu-id="bca9e-441">有关详细信息，请参阅 [SQL Server 数据库引擎和 Azure SQL 数据库安全中心](/sql/relational-databases/security/security-center-for-sql-server-database-engine-and-azure-sql-database?WT.mc_id=iotinsightssoln-docs-ercenk)。</span><span class="sxs-lookup"><span data-stu-id="bca9e-441">For details, see [Security Center for SQL Server Database Engine and Azure SQL Database](/sql/relational-databases/security/security-center-for-sql-server-database-engine-and-azure-sql-database?WT.mc_id=iotinsightssoln-docs-ercenk).</span></span>

<span data-ttu-id="bca9e-442">**成本效益**：任何分析解决方案的核心都是存储。</span><span class="sxs-lookup"><span data-stu-id="bca9e-442">**Cost Efficiency**: At the heart of any analytics solution is the storage.</span></span> <span data-ttu-id="bca9e-443">分析引擎需要速度、效率、安全性和吞吐量，以便在合理时间内处理大量数据。</span><span class="sxs-lookup"><span data-stu-id="bca9e-443">Analytics engines need speed, efficiency, security, and throughput for processing volumes of data in reasonable times.</span></span> <span data-ttu-id="bca9e-444">通过聚合和汇总数据，以及有效地使用多语言存储来充分利用基础平台的设计机制，是有效管理成本的方式。</span><span class="sxs-lookup"><span data-stu-id="bca9e-444">Devising mechanisms to make best of use of the underlying platform, by aggregating and summarizing data, and efficiently using polyglot stores are the means for efficiently managing costs.</span></span> <span data-ttu-id="bca9e-445">由于 Azure 是一个云平台，可以通过一些方法以编程方式停用、重用和调整资源大小。</span><span class="sxs-lookup"><span data-stu-id="bca9e-445">As Azure is a cloud platform, there are methods to programmatically decommission, recommission, and resize resources.</span></span> <span data-ttu-id="bca9e-446">例如，[创建或更新操作](/rest/api/sql/databases/createorupdate?WT.mc_id=iotinsightssoln-docs-ercenk)提供了一种方法来更改 Azure SQL 数据库的数据库大小。</span><span class="sxs-lookup"><span data-stu-id="bca9e-446">For example, the [Create or Update operation](/rest/api/sql/databases/createorupdate?WT.mc_id=iotinsightssoln-docs-ercenk) provides a way to change the database size of Azure SQL Database.</span></span>